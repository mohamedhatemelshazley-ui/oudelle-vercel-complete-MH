<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>oudÃ©lle | Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„ÙƒØ§Ù…Ù„ Ùˆ InstaPay</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Amiri:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        :root {
            --primary: #07501a;
            --gold: #b38b2d;
            --cream: #f4f1e9;
            --white: #ffffff;
            --text: #07501a;
            --bg: #f4f1e9;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .dark-mode {
            --primary: #4caf50;
            --gold: #ffd700;
            --cream: #121212;
            --white: #1e1e1e;
            --text: #e0e0e0;
            --bg: #121212;
            --card-bg: #1e1e1e;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
            transition: 0.3s ease;
        }

        body {
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        /* Ticker */
        .ticker-wrap {
            position: fixed;
            top: 0;
            width: 100%;
            height: 30px;
            background: var(--gold);
            overflow: hidden;
            z-index: 2001;
        }

        .ticker {
            display: inline-block;
            white-space: nowrap;
            padding-right: 100%;
            animation: ticker 25s linear infinite;
            line-height: 30px;
            color: black;
            font-weight: bold;
        }

        @keyframes ticker {
            0% {
                transform: translate3d(0, 0, 0);
            }

            100% {
                transform: translate3d(100%, 0, 0);
            }
        }

        nav {
            background: rgba(7, 80, 26, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 30px;
            z-index: 2000;
            box-shadow: var(--shadow);
            height: 70px;
        }

        .dark-mode nav {
            background: rgba(30, 30, 30, 0.95);
        }

        .logo {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            color: white;
            text-decoration: none;
            cursor: pointer;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-bar {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            outline: none;
            width: 150px;
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: white;
        }

        .cart-status {
            background: var(--gold);
            color: black;
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }

        #home-page {
            min-height: 100vh;
            min-height: 100dvh; /* Dynamic viewport height for mobile browsers */
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        .slider-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
        }

        .hero-content {
            z-index: 1;
            position: relative;
        }

        .hero-title {
            font-family: 'Amiri', serif;
            font-size: clamp(3rem, 10vw, 6rem);
            margin-bottom: 20px;
        }

        .hero-btn {
            background: var(--gold);
            color: black;
            padding: 15px 40px;
            border-radius: 50px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 0 15px var(--gold);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .tabs-container {
            position: sticky;
            top: 100px;
            z-index: 1000;
            background: var(--bg);
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .cat-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 8px 16px;
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--text);
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Thermal Receipt Styles */
        @media print {
            body * {
                visibility: hidden;
            }

            #thermal-receipt,
            #thermal-receipt * {
                visibility: visible;
            }

            #thermal-receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm;
                padding: 10px;
                background: white;
                color: black;
                font-family: 'Courier New', Courier, monospace;
            }
        }

        #thermal-receipt {
            display: none;
        }

        @media screen {
            #thermal-receipt {
                display: none !important;
            }
        }

        .order-history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
        }

        .order-item-row {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-item-row:hover {
            background: #f9f9f9;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px 5%;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            /* Ensure badges position correctly */
        }

        .card h3 {
            color: var(--text);
            margin: 10px 0;
        }

        .card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 10px;
            background: #eee;
        }

        .price-badge {
            background: var(--gold);
            color: black;
            padding: 4px 12px;
            border-radius: 10px;
            font-weight: 800;
            margin-bottom: 10px;
            display: inline-block;
        }

        .weight-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-bottom: 10px;
            background: white;
            color: black;
        }

        .add-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .section-title {
            text-align: center;
            margin: 40px 0 20px;
            font-family: 'Amiri', serif;
            font-size: 2.5rem;
            color: var(--primary);
        }

        .story-section,
        .reviews-section {
            padding: 20px 5%;
            background: var(--card-bg);
            margin: 20px 5%;
            border-radius: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .review-card {
            background: var(--bg);
            padding: 15px;
            border-radius: 15px;
            margin: 10px;
            display: inline-block;
            width: 300px;
            text-align: right;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--card-bg);
            color: var(--text);
            padding: 25px;
            border-radius: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
        }

        footer {
            background: #111;
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }

        footer a {
            color: var(--gold);
            text-decoration: none;
            margin: 0 10px;
        }

        .popup-anim {
            animation: backInDown 0.5s;
        }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            .hero-title {
                font-size: 3rem;
            }

            .nav-controls {
                gap: 5px;
            }

            .search-bar {
                width: 100px;
                padding: 5px;
                font-size: 0.8rem;
            }

            .logo {
                font-size: 1.4rem;
            }

            .slider-bg {
                background-attachment: scroll;
                background-size: cover;
                background-position: center;
            }
        }

        /* Tables Grid */
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .table-card {
            border: 2px solid #ddd;
            border-radius: 15px;
            background: white;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 80px;
            cursor: pointer;
        }

        .table-card.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .table-num {
            font-size: 2.5rem;
            font-weight: 900;
        }

        .hidden {
            display: none !important;
        }

        /* InstaPay UI */
        .ip-btn {
            background: #07501a;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
        }

        /* Admin Dashboard Styles */
        .admin-trigger {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 2002;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-size: 1.5rem;
            transition: 0.3s;
        }

        .admin-trigger:hover {
            transform: scale(1.1);
            background: var(--gold);
        }

        .admin-modal-content {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 25px;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .admin-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px dashed var(--primary);
        }

        .admin-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .admin-input,
        .admin-select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .admin-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th,
        .admin-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .admin-table th {
            background: var(--primary);
            color: white;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }

        .status-available {
            background: #2ecc71;
            color: white;
        }

        .status-unavailable {
            background: #e74c3c;
            color: white;
        }

        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .admin-tab-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--primary);
            background: white;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.85rem;
        }

        .admin-tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .out-of-stock-badge {
            background: #666;
            color: white;
            padding: 5px 15px;
            border-radius: 10px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .discount-status-badge {
            background: #ff0000;
            color: white;
            padding: 5px 15px;
            border-radius: 10px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            font-size: 0.9rem;
            animation: bounceIn 1s infinite alternate;
        }

        .sold-out {
            opacity: 0.7;
            filter: grayscale(0.5);
            pointer-events: none;
        }

        .price-strike-small {
            text-decoration: line-through;
            color: #d32f2f;
            font-size: 0.9rem;
            margin-left: 8px;
            font-weight: bold;
        }

        .old-price-display {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .discount-tag {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff0000;
            color: white;
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 900;
            z-index: 100;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
            animation: superPulse 1.2s infinite ease-in-out;
            pointer-events: none;
        }

        @keyframes superPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 5px rgba(255, 0, 0, 0.7);
            }

            50% {
                transform: scale(1.15);
                box-shadow: 0 0 20px rgba(255, 0, 0, 1);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 5px rgba(255, 0, 0, 0.7);
            }
        }

        /* Engagement Features Styles */
        .lucky-trigger {
            position: fixed;
            bottom: 20px;
            left: 80px;
            background: var(--gold);
            color: black;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 2002;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-size: 1.5rem;
            animation: bounceIn 1.5s infinite alternate;
        }



        .voucher-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }

        .voucher-input-group {
            display: flex;
            gap: 5px;
        }



        .vip-badge {
            background: linear-gradient(45deg, #b38b2d, #ffd700);
            color: black;
            padding: 2px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 900;
            position: absolute;
            top: 5px;
            right: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 5px #ffd700;
            }

            50% {
                box-shadow: 0 0 20px #ffd700;
            }

            100% {
                box-shadow: 0 0 5px #ffd700;
            }
        }

        @keyframes superPulseV2 {
            0% {
                transform: scale(1);
                box-shadow: 0 0 10px #ff0000;
            }

            50% {
                transform: scale(1.2);
                box-shadow: 0 0 25px #ff0000;
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 10px #ff0000;
            }
        }

        .discount-badge-v2 {
            position: absolute !important;
            top: 10px !important;
            right: 10px !important;
            background: #ff0000 !important;
            color: #ffffff !important;
            padding: 6px 14px !important;
            border-radius: 10px !important;
            font-size: 1rem !important;
            font-weight: 900 !important;
            z-index: 10000 !important;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8) !important;
            border: 2px solid white !important;
            animation: superPulseV2 1s infinite ease-in-out !important;
            display: block !important;
            direction: rtl !important;
        }

        /* Ramadan Mode Styles */
        body.ramadan-mode {
            background: #0b1120;
            color: #efc050;
        }

        body.ramadan-mode .card {
            background: #1a2639;
            border: 1px solid #cfa935;
        }

        body.ramadan-mode .admin-modal-content {
            background: #fff !important;
            color: #000 !important;
            border: 4px solid #cfa935;
        }

        body.ramadan-mode .admin-input,
        body.ramadan-mode .admin-select {
            background: #fff !important;
            color: #000 !important;
            border: 1px solid #ccc !important;
        }

        body.ramadan-mode .admin-modal-content h2,
        body.ramadan-mode .admin-modal-content h3,
        body.ramadan-mode .admin-modal-content label {
            color: #07501a !important;
        }



        /* Force High Contrast for ALL text in Ramadan Mode */
        body.ramadan-mode,
        body.ramadan-mode .card,
        body.ramadan-mode .card *,
        body.ramadan-mode p,
        body.ramadan-mode span,
        body.ramadan-mode label,
        body.ramadan-mode .modal-content *,
        body.ramadan-mode .tabs-container *,
        body.ramadan-mode .admin-section *,
        body.ramadan-mode .story-section p {
            color: #e2e8f0 !important;
        }

        body.ramadan-mode h1,
        body.ramadan-mode h2,
        body.ramadan-mode h3,
        body.ramadan-mode .section-title,
        body.ramadan-mode .price-badge,
        body.ramadan-mode .old-price-display,
        body.ramadan-mode .price-strike-small {
            color: var(--gold) !important;
        }

        body.ramadan-mode .price-badge {
            background: rgba(251, 191, 36, 0.1) !important;
            border: 1px solid var(--gold) !important;
            font-weight: bold !important;
        }

        body.ramadan-mode input,
        body.ramadan-mode textarea,
        body.ramadan-mode select {
            background: #1e293b !important;
            color: #fff !important;
            border: 1px solid var(--gold) !important;
        }

        body.ramadan-mode .card {
            background: #1e293b !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5) !important;
            border: 1px solid var(--gold) !important;
        }

        body.ramadan-mode .story-section,
        body.ramadan-mode .story-section p,
        body.ramadan-mode .review-card,
        body.ramadan-mode .review-card *,
        body.ramadan-mode footer,
        body.ramadan-mode footer p,
        body.ramadan-mode footer a,
        body.ramadan-mode .designer-credit,
        body.ramadan-mode .designer-credit a,
        body.ramadan-mode b {
            color: #e2e8f0 !important;
        }

        body.ramadan-mode .review-card {
            background: #1e293b !important;
            border: 1px solid var(--gold) !important;
        }

        body.ramadan-mode footer a {
            text-decoration: underline !important;
            color: var(--gold) !important;
        }

        body.ramadan-mode .tab {
            color: #cbd5e1 !important;
            background: #1e293b !important;
            border: 1px solid #475569 !important;
        }

        body.ramadan-mode .tab.active {
            background: var(--gold) !important;
            color: #000 !important;
            border-color: var(--gold) !important;
        }

        body.ramadan-mode .tab.active * {
            color: #000 !important;
        }

        body.ramadan-mode .story-section {
            background: #1e293b !important;
            border: 1px solid var(--gold) !important;
            padding: 20px !important;
            border-radius: 15px !important;
        }

        body.ramadan-mode .vip-badge {
            background: linear-gradient(45deg, #fbbf24, #d97706) !important;
            color: #000 !important;
        }

        /* --- Ramadan Compass & Atmospheric Styles --- */
        #ramadan-compass {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: rgba(30, 41, 59, 0.9);
            border: 2px solid var(--gold);
            border-radius: 50%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            animation: compassGlow 2s infinite alternate;
        }

        body.ramadan-mode #ramadan-compass {
            display: flex;
        }

        @keyframes compassGlow {
            from {
                box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
            }

            to {
                box-shadow: 0 0 25px rgba(251, 191, 36, 0.6);
            }
        }

        .compass-dial {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px dashed var(--gold);
            opacity: 0.3;
            animation: rotateDial 20s linear infinite;
        }

        @keyframes rotateDial {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .iftar-timer {
            font-size: 0.7rem;
            color: var(--gold);
            text-align: center;
            line-height: 1.1;
            font-weight: bold;
        }

        .compass-icon {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        /* Day/Night Transition Overlay */
        #sky-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            transition: background 2s ease;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 1s ease;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.3;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        body.ramadan-mode.night-time {
            background: #020617 !important;
        }

        /* --- Order Success Overlay & Box Animation --- */
        #order-success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            perspective: 1000px;
            overflow: hidden;
        }

        .success-content {
            text-align: center;
            animation: fadeIn 1s ease;
        }

        .success-title {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 30px;
            font-weight: bold;
        }

        /* 3D Box Styling */
        .box-wrapper {
            width: 200px;
            height: 150px;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(-20deg) rotateY(20deg);
            margin: 50px auto;
            animation: boxEntry 1s ease forwards;
        }

        .box-part {
            position: absolute;
            background: #1e4d2b;
            /* Luxury Green */
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Outfit', sans-serif;
            font-weight: bold;
            color: white;
            font-size: 1.5rem;
            backface-visibility: hidden;
        }

        .box-front {
            width: 200px;
            height: 100px;
            transform: translateZ(50px);
        }

        .box-back {
            width: 200px;
            height: 100px;
            transform: rotateY(180deg) translateZ(50px);
        }

        .box-right {
            width: 100px;
            height: 100px;
            transform: rotateY(90deg) translateZ(100px);
            left: 50px;
        }

        .box-left {
            width: 100px;
            height: 100px;
            transform: rotateY(-90deg) translateZ(100px);
            left: 50px;
        }

        .box-bottom {
            width: 200px;
            height: 100px;
            transform: rotateX(-90deg) translateZ(50px);
            top: 50px;
        }

        .box-top {
            width: 200px;
            height: 105px;
            background: #1e4d2b;
            position: absolute;
            top: 0;
            transform-origin: top;
            transform: rotateX(90deg) translateZ(100px);
            animation: closeBoxTop 2s cubic-bezier(0.4, 0, 0.2, 1) forwards 1s;
        }

        .box-branding {
            font-family: 'serif';
            font-style: italic;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* Golden Ribbon */
        .ribbon {
            position: absolute;
            background: var(--gold);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
            opacity: 0;
            z-index: 10;
        }

        .ribbon-v {
            width: 20px;
            height: 100%;
            left: 90px;
            top: 0;
            transform: translateZ(51px);
        }

        .ribbon-h {
            width: 100%;
            height: 20px;
            left: 0;
            top: 40px;
            transform: translateZ(51px);
        }

        .ribbon-animation {
            animation: tieRibbon 1.5s ease forwards 2.5s;
        }

        @keyframes closeBoxTop {
            from {
                transform: rotateX(-90deg) translateZ(0);
            }

            to {
                transform: rotateX(0deg) translateZ(100px);
            }
        }

        @keyframes tieRibbon {
            from {
                opacity: 0;
                transform: scale(0) translateZ(51px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateZ(51px);
            }
        }

        @keyframes boxEntry {
            from {
                opacity: 0;
                transform: translateY(100px) rotateX(-20deg) rotateY(45deg);
            }

            to {
                opacity: 1;
                transform: translateY(0) rotateX(-20deg) rotateY(20deg);
            }
        }

        /* Success Message Styling */
        .preparing-msg {
            font-size: 1.2rem;
            margin-top: 20px;
            color: #cbd5e1;
            opacity: 0;
            animation: fadeIn 1s ease forwards 3.5s;
        }

        .fallback-btn {
            background: #25d366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            margin-top: 20px;
            cursor: pointer;
            opacity: 0;
            display: none;
            animation: fadeIn 1s ease forwards 5s;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        #confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        body.ramadan-mode .best-sellers-container {
            background: linear-gradient(135deg, #1e293b, #0f172a) !important;
            border: 1px solid var(--gold) !important;
        }

        body.ramadan-mode .admin-trigger,
        body.ramadan-mode .lucky-trigger {
            background: var(--gold) !important;
            color: #000 !important;
        }

        /* Ramadan Moon/Star Accents */
        body.ramadan-mode .hero::after {
            content: "ğŸŒ™";
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 2rem;
            filter: drop-shadow(0 0 10px gold);
            animation: starPulse 3s infinite;
        }

        /* Best Sellers Section */
        .best-sellers-container {
            padding: 20px;
            background: linear-gradient(90deg, #fffcf0, #fff);
            margin: 20px 10px;
            border-radius: 15px;
            border-right: 5px solid var(--gold);
        }

        .best-sellers-grid {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
            scrollbar-width: none;
        }

        .best-seller-item {
            min-width: 150px;
            text-align: center;
            flex-shrink: 0;
        }

        .best-seller-item img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--gold);
        }

        /* Gallery Section */
        .gallery-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            padding: 20px;
        }

        .gallery-item {
            height: 150px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: 0.3s;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        /* Admin Stats Bar */
        .admin-stats-bar {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-bottom: 3px solid var(--gold);
        }

        .stat-val {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .reset-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            margin-top: 5px;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }


        /* Pre-Order Date/Time Styling */
        .schedule-input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
            margin-top: 5px;
            margin-bottom: 15px;
            font-family: inherit;
        }

        .ramadan-mode .schedule-input {
            background: #1e293b !important;
            color: #fff !important;
            border-color: var(--gold) !important;
        }

        @keyframes starPulse {
            0% {
                opacity: 0.5;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }

            100% {
                opacity: 0.5;
                transform: scale(1);
            }
        }

        @keyframes slideDown {
            from {
                transform: translate(-50%, -100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 0);
                opacity: 1;
            }
            to {
                transform: translate(-50%, -100px);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div id="order-success-overlay">
        <div id="confetti-container"></div>
        <div class="success-content">
            <div class="success-title">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! â¤ï¸</div>
            <div class="box-wrapper">
                <div class="box-part box-front">
                    <span class="box-branding">oudÃ©lle</span>
                    <div class="ribbon ribbon-h ribbon-animation"></div>
                </div>
                <div class="box-part box-back"></div>
                <div class="box-part box-left"></div>
                <div class="box-part box-right"></div>
                <div class="box-part box-bottom"></div>
                <div class="box-part box-top">
                    <!-- Ribbon on top -->
                    <div class="ribbon ribbon-v ribbon-animation"
                        style="height: 105px; left: 90px; transform: translateZ(1px);"></div>
                </div>
            </div>
            <div class="preparing-msg">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø·Ù„Ø¨Ùƒ ÙˆØªØºÙ„ÙŠÙÙ‡ Ø¨ÙƒÙ„ Ø­Ø¨... ğŸ</div>
            <button id="wa-fallback-btn" class="fallback-btn" onclick="window.location.href=window.pendingWaUrl">Ø¥Ø±Ø³Ø§Ù„
                Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¢Ù† ğŸŸ¢</button>
        </div>
    </div>
    <div id="ramadan-compass" onclick="showIftarInfo()">
        <div class="compass-dial"></div>
        <div class="compass-icon">ğŸŒ™</div>
        <div id="iftar-countdown" class="iftar-timer">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>
    </div>
    <div class="ticker-wrap">
        <div class="ticker">
            Ø¹Ø±Ø¶ Ø®Ø§Øµ: Ø®ØµÙ… 10% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹! | Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 500 Ø¬.Ù… | Ø¬Ø±Ø¨
            Ø§Ù„ÙƒÙ†Ø§ÙØ© Ø§Ù„Ù†Ø§Ø¨Ù„Ø³ÙŠØ© Ø§Ù„Ø¢Ù†!
        </div>
    </div>

    <nav>
        <div class="logo" onclick="showHome()">oudÃ©lle</div>
        <div class="nav-controls">
            <input type="text" class="search-bar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." onkeyup="searchProducts(this.value)">
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
            <div id="cart-btn" class="cart-status" onclick="showCart()">ğŸ›’ <span id="cart-count">0</span></div>
        </div>
    </nav>

    <section id="home-page">
        <div class="slider-bg" id="slider-bg" style="background: linear-gradient(135deg, #07501a, #b38b2d);"></div>
        <div class="overlay"></div>
        <div class="hero-content">
            <h1 class="hero-title animate__animated animate__fadeInDown">oudÃ©lle</h1>
            <p class="animate__animated animate__fadeInUp">Desserts & More - Since 1951</p>
            <button class="hero-btn animate__animated animate__zoomIn" onclick="showMenu()">ØªØµÙØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
        </div>
    </section>

    <section id="menu-page" style="display: none; padding-top: 80px;">
        <div class="tabs-container">
            <div class="cat-tabs" id="category-tabs-container">
                <!-- Categories will be rendered here dynamically -->
            </div>
        </div>
        <div id="best-sellers-section" class="best-sellers-container hidden">
            <h3 style="margin-bottom:10px; font-size:1.1rem;">ğŸ”¥ Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
            <div id="best-sellers-grid" class="best-sellers-grid"></div>
        </div>

        <div id="product-grid" class="grid animate__animated animate__fadeIn"></div>

        <h2 class="section-title">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ğŸ“¸</h2>
        <div id="customer-gallery" class="gallery-container"></div>

        <h2 class="section-title">Ù‚ØµØªÙ†Ø§</h2>
        <div class="story-section">
            <p style="font-size: 1.1rem; line-height: 1.8;">
                Ø¨Ø¯Ø£Øª Ø±Ø­Ù„Ø© oudÃ©lle Ø¹Ø§Ù… 1951 Ø¨Ø´ØºÙ ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø§Ù„Ø£ØµÙŠÙ„Ø©.
                Ù†ØªÙˆØ§Ø±Ø« Ø³Ø± Ø§Ù„ØµÙ†Ø¹Ø© Ø¬ÙŠÙ„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø¬ÙŠÙ„ØŒ Ù„Ù†Ù‚Ø¯Ù… Ù„ÙƒÙ… Ø·Ø¹Ù…Ø§Ù‹ Ù„Ø§ ÙŠÙ†Ø³Ù‰ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø±Ø§Ù‚Ø© ÙˆØ§Ù„Ø­Ø¯Ø§Ø«Ø©.
            </p>
        </div>

        <h2 class="section-title">Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
        <div class="reviews-section">
            <div class="review-card">
                â­â­â­â­â­<br>"Ø£Ø­Ù„Ù‰ Ø¨Ø³Ø¨ÙˆØ³Ø© Ø£ÙƒÙ„ØªÙ‡Ø§ ÙÙŠ Ø­ÙŠØ§ØªÙŠØŒ ØªØ³Ù„Ù… Ø§Ù„Ø£ÙŠØ§Ø¯ÙŠ!"<br><b>- Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</b>
            </div>
            <div class="review-card">
                â­â­â­â­â­<br>"Ø§Ù„ÙƒÙ†Ø§ÙØ© Ø§Ù„Ù†Ø§Ø¨Ù„Ø³ÙŠØ© Ø¨ØªÙˆØµÙ„ Ø³Ø®Ù†Ø© ÙˆØ·Ø¹Ù…Ù‡Ø§ ØªØ­ÙØ©."<br><b>- Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ</b>
            </div>
        </div>

        <footer>
            <p>Â© 2026 oudÃ©lle Desserts. All rights reserved.</p>
            <div style="margin-top: 10px;">
                <a href="https://maps.app.goo.gl/6DHVYyxcTM3BcHKL8" target="_blank">ğŸ“ Ù…ÙˆÙ‚Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a> |
                <a href="tel:+201023728183">ğŸ“ Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
            </div>
            <div style="margin-top: 15px; font-size: 0.9rem; color: var(--gold);">
                <span class="designer-credit">Designed by <a href="tel:01025693460"
                        style="color: white; text-decoration: underline;">Eng. Mohamed Hatem</a></span>
            </div>
        </footer>
    </section>

    <div id="cartModal" class="modal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 20px;">ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨Ùƒ ğŸ›ï¸</h2>
            <div id="cart-list"></div>
            <div style="background: var(--cream); padding: 15px; border-radius: 20px; margin: 20px 0;">
                <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</label>
                <select id="del-method" class="weight-select" onchange="toggleFields()">
                    <option value="delivery">Ø¯Ù„ÙŠÙØ±ÙŠ (ØªÙˆØµÙŠÙ„)</option>
                    <option value="pickup">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹</option>
                    <option value="dinein">Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø·Ø¹Ù…</option>
                </select>

                <div id="instapay-ui">
                    <p style="color: #0d47a1; font-weight: 900; margin-bottom: 5px;">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± InstaPay:</p>
                    <p style="font-size: 1.1rem; color: #333; margin-bottom: 8px;">01091031582</p>
                    <div style="display: flex; justify-content: center; gap: 8px;">
                        <button class="ip-btn" onclick="copyNumber()">Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù… ğŸ“‹</button>
                        <a href="https://ipn.eg/S/01091031582" target="_blank" class="ip-btn"
                            style="background: #2196f3;">ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ“±</a>
                    </div>
                    <p style="font-size: 0.75rem; color: #d81b60; margin-top: 8px; font-weight: bold;">( ØµÙˆØ± Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø¹Ø¯
                        Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ±Ø¯Ø±)</p>
                </div>

                <div id="dinein-field" class="hidden">
                    <label>Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©:</label>
                    <div class="tables-grid">
                        <div class="table-card" onclick="selectTable(1, this)"><span class="table-num">1</span></div>
                        <div class="table-card" onclick="selectTable(2, this)"><span class="table-num">2</span></div>
                        <div class="table-card" onclick="selectTable(3, this)"><span class="table-num">3</span></div>
                        <div class="table-card" onclick="selectTable(4, this)"><span class="table-num">4</span></div>
                    </div>
                </div>

                <div id="waiter-field" class="hidden" style="margin-top:10px;">
                    <button class="ip-btn" style="width:100%; background:var(--gold); color:black;"
                        onclick="callWaiter()">ğŸ”” Ù†Ø¯Ø§Ø¡ Ù„Ù„Ø¬Ø±Ø³ÙˆÙ†</button>
                </div>

                <div class="input-group" id="delivery-field" style="margin-top:10px;">
                    <label>Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</label>
                    <select id="area-select" onchange="updateTotal()">
                        <!-- Dynamic areas will be loaded here -->
                    </select>
                </div>
                <input type="text" id="c-addr" class="weight-select" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">

                <div id="phone-field">
                    <input type="tel" id="c-phone" class="weight-select" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                </div>

                <div id="schedule-toggle-container" class="hidden" style="margin-top:15px; text-align:center;">
                    <button class="ip-btn"
                        style="width:100%; background:#fff3e0; color:#d84315; border:1px solid #ffe0b2;"
                        onclick="toggleSchedule()">ğŸ—“ï¸ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø®ØµÙˆØµØŸ</button>
                </div>

                <div id="schedule-field" class="hidden"
                    style="margin-top:10px; border-top:1px dashed #ccc; padding-top:10px;">
                    <label style="font-size:0.85rem; color:#d84315;">ğŸ—“ï¸ Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ù‡Ùˆ / ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø£ÙˆØ±Ø¯Ø±:</label>
                    <div style="display:flex; gap:10px; margin-top:5px;">
                        <input type="date" id="order-date" class="schedule-input" style="flex:1;">
                        <input type="time" id="order-time" class="schedule-input" style="flex:1;">
                    </div>
                </div>
            </div>
            <input type="text" id="c-name" class="weight-select" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">

            <div class="voucher-section">
                <label style="font-size:0.8rem;">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¯ Ø®ØµÙ…ØŸ</label>
                <div class="voucher-input-group">
                    <input type="text" id="v-code" class="admin-input" style="flex:1;" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…">
                    <button class="admin-btn" style="padding:5px 15px;" onclick="applyVoucher()">ØªØ·Ø¨ÙŠÙ‚</button>
                </div>
                <p id="v-msg" style="font-size:0.75rem; margin-top:5px;"></p>
            </div>

            <h3 id="total-price" style="text-align: center; color: var(--gold); margin-bottom: 10px; margin-top:15px;">
            </h3>
            <button class="add-btn" style="background:#25D366;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø·Ø¹Ù… âœ…</button>
            <button onclick="showCart()"
                style="width:100%; background:none; border:none; color:red; margin-top:15px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="admin-modal-content">
            <h2
                style="text-align: center; margin-bottom: 20px; color: var(--primary); border-bottom: 2px solid var(--gold); padding-bottom: 15px;">
                Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø£ØµÙ†Ø§Ù oudÃ©lle âš™ï¸</h2>

            <div class="admin-stats-bar">
                <div class="stat-card">
                    <p style="font-size:0.8rem; color:#666;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                    <div id="stat-orders" class="stat-val">0</div>
                    <button class="reset-btn" onclick="resetTotalOrders()" style="background: #e74c3c; margin-top: 5px;">ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª ğŸ“Š</button>
                </div>
                <div class="stat-card">
                    <p style="font-size:0.8rem; color:#666;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
                    <div id="stat-revenue" class="stat-val">0 Ø¬</div>
                    <button class="reset-btn" onclick="resetRevenue()" style="background: #ff9800; margin-top: 5px;">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ğŸ’°</button>
                </div>
                <div class="stat-card" style="background: #fee2e2; border-color: #f87171;">
                    <p style="font-size:0.8rem; color:#b91c1c;">ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                    <button class="reset-btn" onclick="resetOrderCounter()">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯ ğŸ”„</button>
                    <button class="reset-btn" onclick="clearAllOrders()" style="background: #dc3545; margin-top: 5px;">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª ğŸ—‘ï¸</button>
                </div>
            </div>

            <div class="admin-section" style="background:#fff3e0; border:1px solid #ffe0b2;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0;">ğŸŒ™ ÙˆØ¶Ø¹ Ø±Ù…Ø¶Ø§Ù†</h3>
                    <button id="ramadan-toggle-btn" class="admin-btn" style="width:auto; padding:5px 20px;"
                        onclick="toggleRamadanMode()">ØªÙØ¹ÙŠÙ„</button>
                </div>
            </div>

            <div class="admin-section">
                <h3>ğŸ–¼ï¸ ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="file" id="home-bg-input" accept="image/*" style="flex:1;" onchange="handleHomeBgUpload(event)">
                    <button class="admin-btn" style="width:auto; padding:5px 15px;" onclick="document.getElementById('home-bg-input').click()">Ø§Ø®ØªØ± ØµÙˆØ±Ø©</button>
                </div>
                <div id="home-bg-preview" style="margin-top:10px; text-align:center;"></div>
            </div>

            <div class="admin-section">
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <div class="admin-form">
                    <select id="adm-cat" class="admin-select">
                        <!-- Options rendered dynamically -->
                    </select>
                    <input type="text" id="adm-name" class="admin-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                    <input type="number" id="adm-price" class="admin-input" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… (Ø§Ù„Ø­Ø§Ù„ÙŠ)">
                    <input type="number" id="adm-old-price" class="admin-input" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    <select id="adm-type" class="admin-select">
                        <option value="kg">Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ</option>
                        <option value="piece">Ø¨Ø§Ù„Ù‚Ø·Ø¹Ø©</option>
                    </select>
                    <textarea id="adm-type-custom" class="admin-input"
                        style="height:80px; resize:vertical; padding:8px;"
                        placeholder="Ø£Ø·Ø¹Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø§ÙƒØªØ¨ ÙƒÙ„ Ø·Ø¹Ù… ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„)"></textarea>
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <input type="file" id="product-img-input" accept="image/*" style="flex:1;" onchange="handleProductImgUpload(event)">
                        <button class="admin-btn" style="width:auto; padding:5px 15px;" onclick="document.getElementById('product-img-input').click()">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</button>
                    </div>
                    <input type="text" id="adm-img" class="admin-input" placeholder="Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© (ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)">
                    <input type="hidden" id="adm-edit-mode-index" value="-1">
                    <button id="adm-action-btn" class="admin-btn" onclick="admAddProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
                    <button id="adm-cancel-edit-btn" class="admin-btn"
                        style="background:#f44336; display:none; margin-top:5px;" onclick="admCancelEdit()">Ø¥Ù„ØºØ§Ø¡
                        Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
                </div>
            </div>

            <div class="admin-section">
                <h3>ğŸ“‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="adm-new-cat-name" class="admin-input" style="flex:2;"
                        placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„Ø§Ù‹: Ù†ÙˆØ§Ø¹Ù… Ø§Ù„Ø¹ÙŠØ¯)">
                    <input type="text" id="adm-new-cat-id" class="admin-input" style="flex:1;"
                        placeholder="ID (Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙÙ‚Ø·: eid)">
                    <button class="admin-btn" style="width:auto; padding:5px 15px;"
                        onclick="admAddCategory()">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="adm-cats-list" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
            </div>

            <div class="admin-tabs" id="adm-category-tabs"></div>

            <div style="overflow-x: auto; margin-top: 15px;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…)</th>
                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…)</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
                            <th>Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="adm-items-table"></tbody>
                </table>
            </div>

            <div class="admin-section" style="margin-top:20px; border-top:2px solid var(--gold); padding-top:20px;">
                <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                <div class="admin-form">
                    <label>Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø¨Ø¯ÙˆÙ† +):</label>
                    <input type="text" id="adm-wa-num" class="admin-input" placeholder="2010XXXXXXXX">
                    <label>Ù†Øµ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ticker):</label>
                    <textarea id="adm-ticker-text" class="admin-input" style="height:60px;"></textarea>
                    <button class="admin-btn" onclick="admSaveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</button>
                </div>
            </div>

            <div class="admin-section">
                <h3>ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ… (Vouchers)</h3>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="adm-v-code" class="admin-input" style="flex:2;"
                        placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… (Ù…Ø«Ù„Ø§Ù‹: OUD10)">
                    <input type="number" id="adm-v-perc" class="admin-input" style="flex:1;" placeholder="%">
                    <button class="admin-btn" style="width:auto; padding:5px 15px;"
                        onclick="admAddVoucher()">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="adm-vouchers-list" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
            </div>

            <div class="admin-section">
                <h3>ğŸšš Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</h3>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="adm-area-name" class="admin-input" style="flex:2;" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
                    <input type="number" id="adm-area-price" class="admin-input" style="flex:1;" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                    <button class="admin-btn" style="width:auto; padding:5px 15px;"
                        onclick="admAddArea()">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="adm-areas-list" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
            </div>

            <div class="admin-section">
                <h3>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ± (Ø¢Ø®Ø± 50 Ø·Ù„Ø¨)</h3>
                <div class="order-history-list" id="adm-orders-list"></div>
            </div>

            <div class="admin-section">
                <h3>ğŸ± Ù…Ø­Ø±Ø± Ø§Ù„Ø¨ÙˆÙƒØ³ Ø§Ù„Ù…Ø´ÙƒÙ„ (Ø¹Ù„ÙŠ ÙƒÙŠÙÙƒ)</h3>
                <div id="adm-mix-editor"
                    style="background:#fff; padding:15px; border-radius:10px; border:1px solid #ddd;">
                    <!-- Mix Editor UI here -->
                </div>
            </div>

            <div class="admin-section">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</h3>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="adm-gallery-url" class="admin-input" style="flex:1;"
                        placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (URL)">
                    <button class="admin-btn" style="width:auto; padding:5px 15px;"
                        onclick="admAddGallery()">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="adm-gallery-list" style="display:flex; gap:5px; margin-top:10px; overflow-x:auto;"></div>
            </div>

            <button onclick="document.getElementById('adminModal').style.display='none'"
                style="width:100%; background:none; border:none; color:red; margin-top:20px; cursor:pointer; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚
                Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        </div>
    </div>

    <!-- Firebase SDKs (Compat for simple HTML usage) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyB7pFoM2AeEJnWo9SVQ594P5pt9tuXRGg4",
            authDomain: "oudelle.firebaseapp.com",
            databaseURL: "https://oudelle-default-rtdb.firebaseio.com",
            projectId: "oudelle",
            storageBucket: "oudelle.firebasestorage.app",
            messagingSenderId: "44390123746",
            appId: "1:44390123746:web:4932a37011924d5bce36bb",
            measurementId: "G-R3LS4MJNSY"
        };

        let db, auth;
        let isCloudActive = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            isCloudActive = true;
            console.log("ğŸ”¥ Firebase initialized successfully!");
            console.log("ğŸ“± Project ID:", firebaseConfig.projectId);
            
            // Test Firestore connection
            db.collection('app').doc('data').get().then((doc) => {
                console.log("âœ… Firestore connection test passed!");
                if (doc.exists) {
                    console.log("ğŸ“¦ Data found in cloud");
                } else {
                    console.log("âš ï¸ No data in cloud yet - will create on first save");
                }
            }).catch((err) => {
                console.error("âŒ Firestore connection failed:", err.message);
                console.log("ğŸ’¡ Fix: Go to Firebase Console â†’ Firestore Database â†’ Create database â†’ Start in test mode");
            });
        } catch (e) {
            console.error("Firebase Init Error:", e);
            isCloudActive = false;
        }
        
        // Fallback: Ensure database loads even if Firebase fails
        if (!isCloudActive) {
            console.log("âš ï¸ Running in Local Mode (no Firebase)");
            loadDatabase();
            ensureDefaults();
        }
        let WHATSAPP_NUM = "201023728183";
        let TICKER_TEXT = "Ø¹Ø±Ø¶ Ø®Ø§Øµ: Ø®ØµÙ… 10% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹! | Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 500 Ø¬.Ù… | Ø¬Ø±Ø¨ Ø§Ù„ÙƒÙ†Ø§ÙØ© Ø§Ù„Ù†Ø§Ø¨Ù„Ø³ÙŠØ© Ø§Ù„Ø¢Ù†!";
        let cart = JSON.parse(localStorage.getItem('oudelle_cart')) || [];
        let selectedTableNumber = null;
        let currentCat = 'oriental';
        let admCurrentCat = 'oriental';
        let isRamadanMode = localStorage.getItem('oudelle_ramadan') === 'true';

        let database = {
            oriental: [
                { name: "Ø¨Ø³Ø¨ÙˆØ³Ù‡ Ø³Ø§Ø¯Ù‡", price: 175, type: 'kg', img: "" },
                { name: "Ø¨Ø³Ø¨ÙˆØ³Ù‡ Ù…ÙƒØ³Ø±Ø§Øª", price: 240, type: 'kg', img: "" },
                { name: "Ø¨Ø³Ø¨ÙˆØ³Ù‡ Ù‚Ø´Ø·Ù‡", price: 220, type: 'kg', img: "" },
                { name: "Ø¨Ø³Ø¨ÙˆØ³Ù‡ Ù†ÙˆØªÙŠÙ„Ø§", price: 215, type: 'kg', img: "" },
                { name: "Ø¨Ø³Ø¨ÙˆØ³Ù‡ Ù„ÙˆØªØ³", price: 215, type: 'kg', img: "" },
                { name: "Ø¬Ù„Ø§Ø´ Ø³Ø§Ø¯Ù‡", price: 170, type: 'kg', img: "" },
                { name: "Ø¬Ù„Ø§Ø´ ÙƒØ±ÙŠÙ…Ù‡", price: 200, type: 'kg', img: "" },
                { name: "Ø¬Ù„Ø§Ø´ Ø¨Ø±Ù…Ù‡ Ø³Ø§Ø¯Ù‡", price: 230, type: 'kg', img: "" },
                { name: "Ø¨Ù‚Ù„Ø§ÙˆÙ‡ ØªØ±ÙƒÙŠ Ù…ÙƒØ³Ø±Ø§Øª", price: 400, type: 'kg', img: "" },
                { name: "Ø¨Ù‚Ù„Ø§ÙˆÙ‡ ØªØ±ÙƒÙŠ ÙØ³ØªÙ‚ Ø­Ù„Ø¨ÙŠ", price: 650, type: 'kg', img: "" },
                { name: "Ø¨Ù‚Ù„Ø§ÙˆÙ‡ Ù‚Ø´Ø·Ù‡", price: 650, type: 'kg', img: "" },
                { name: "Ø´ÙƒÙ„Ù…Ù‡ Ø³Ù…Ù† Ø¨Ù„Ø¯ÙŠ", price: 280, type: 'kg', img: "" },
                { name: "Ù…Ø¯Ù„Ø¹Ù‡ Ø³Ù…Ù† Ø¨Ù„Ø¯ÙŠ", price: 220, type: 'kg', img: "" },
                { name: "Ø­Ø¨ÙŠØ¨Ù‡ Ù…ÙƒØ³Ø±Ø§Øª", price: 220, type: 'kg', img: "" },
                { name: "Ø±Ù…ÙˆØ´ Ø§Ù„Ø³Øª", price: 220, type: 'kg', img: "" },
                { isMix: true, title: "Ø¹Ù„ÙŠ ÙƒÙŠÙÙƒ (Ø´Ø±Ù‚ÙŠ Ù…Ø´ÙƒÙ„)", source: 'oriental' }
            ],
            nabulsia: [
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ø¬Ø¨Ù†Ù‡ ", price: 35, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ø¬Ø¨Ù†Ù‡ (ÙˆØ³Ø·)", price: 50, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ø¬Ø¨Ù†Ù‡ (ÙƒØ¨ÙŠØ±Ø©)", price: 120, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ø¬Ø¨Ù†Ù‡ (Ø¹Ø§Ø¦Ù„ÙŠØ©)", price: 200, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ø¬Ø¨Ù†Ø© (Ø¬Ø§Ù…Ø¨Ùˆ)", price: 250, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ù‚Ø´Ø·Ù‡ ", price: 35, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ù‚Ø´Ø·Ù‡ (ÙˆØ³Ø·)", price: 50, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ù‚Ø´Ø·Ù‡ (ÙƒØ¨ÙŠØ±Ø©)", price: 120, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ù‚Ø´Ø·Ù‡ (Ø¹Ø§Ø¦Ù„ÙŠØ©)", price: 200, type: 'piece', img: "" },
                { name: "ÙƒÙ†Ø§ÙÙ‡ Ù†Ø§Ø¨Ù„Ø³ÙŠÙ‡ Ù‚Ø´Ø·Ù‡ (Ø¬Ø§Ù…Ø¨Ùˆ)", price: 250, type: 'piece', img: "" }
            ],
            dairy: [
                { name: "Ø±Ø² Ø¨Ù„Ø¨Ù† Ø³Ø§Ø¯Ù‡", price: 25, type: 'piece', img: "" },
                { name: "Ù‚Ø´Ø·ÙˆØ·Ù‡ (Ù„ÙˆØªØ³/Ù†ÙˆØªÙŠÙ„Ø§/Ø¨Ø³ØªØ§Ø´ÙŠÙˆ)", price: 75, type: 'piece', img: "" },
                { name: "ØªØ±Ù„ØªØ´ÙŠ (ÙƒØ±Ø§Ù…ÙŠÙ„/Ø´ÙˆÙƒÙ„Øª)", price: 75, type: 'piece', img: "" },
                { name: "Ù…Ø­Ù„Ø§ÙŠÙ‡ Ø´Ø§Ù…ÙŠÙ‡", price: 75, type: 'piece', img: "" },
                { name: "Ø§Ù… Ø¹Ù„ÙŠ Ù…ÙƒØ³Ø±Ø§Øª", price: 75, type: 'piece', img: "" },
                { name: "Ø·Ø§Ø¬Ù† Ù†ÙˆØªÙŠÙ„Ø§", price: 75, type: 'piece', img: "" },
                { name: "Ù…ÙˆÙ„ØªÙ† ÙƒÙŠÙƒ", price: 55, type: 'piece', img: "" },
                { name: "Ø´ÙˆÙƒÙ„Øª Ø¨ÙˆÙ„", price: 55, type: 'piece', img: "" }
            ],
            jordanian: [
                { name: "Ø¨Ø±Ø§Ø²Ù‚ Ø³Ù…Ø³Ù…", price: 30, type: 'piece', img: "" },
                { name: "Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ø§Ù„ØªÙ…Ø±", price: 300, type: 'piece', img: "" },
                { name: "ØºØ±ÙŠØ¨Ù‡", price: 300, type: 'piece', img: "" },
                { name: "Ù…Ø¹Ù…ÙˆÙ„ Ø³Ù…ÙŠØ· Ø¹ÙŠÙ† Ø¬Ù…Ù„", price: 300, type: 'piece', img: "" },
                { name: "Ù„ÙŠØ§Ù„ÙŠ Ù„Ø¨Ù†Ø§Ù†", price: 175, type: 'kg', img: "" },
                { name: "Ø­Ø¨ÙŠØ¨Ù‡", price: 175, type: 'kg', img: "" },
                { name: "ÙˆØ±Ø¨Ø§Øª", price: 175, type: 'kg', img: "" },
                { name: "Ù†Ù…ÙˆØ±Ù‡", price: 175, type: 'kg', img: "" },
                { name: "Ø¹ÙŠØ´ Ø§Ù„Ø³Ø±Ø§ÙŠØ§", price: 175, type: 'kg', img: "" },
                { name: "Ø¯Ø­Ø¯Ø­", price: 175, type: 'kg', img: "" },
                { name: "Ù‡Ø±ÙŠØ³Ù‡", price: 175, type: 'kg', img: "" }
            ],
            Westernsweets: [
                { name: "ØªÙˆØ±ØªÙ‡ Ù…Ù‚Ø§Ø³ 18", price: 200, type: 'piece', img: "" },
                { name: "ØªÙˆØ±ØªÙ‡ Ù…Ù‚Ø§Ø³ 20", price: 250, type: 'piece', img: "" },
                { name: "ØªÙˆØ±ØªÙ‡ Ù…Ù‚Ø§Ø³ 22", price: 300, type: 'piece', img: "" },
                { name: "ØªÙˆØ±ØªÙ‡ Ù…Ù‚Ø§Ø³ 24", price: 350, type: 'piece', img: "" },
                { name: "ØªÙˆØ±ØªÙ‡ Ù…Ù‚Ø§Ø³ 26", price: 400, type: 'piece', img: "" },
                { name: "ØªÙˆØ±ØªÙ‡ Ù…Ù‚Ø§Ø³ 28", price: 450, type: 'piece', img: "" },
                { name: "ØªØ´ÙŠØ² ÙƒÙŠÙƒ", price: 45, type: 'piece', img: "" },
                { name: "ØªØ´ÙŠØ² ÙƒÙŠÙƒ Ø§Ø³Ø¨Ø§Ù†ÙŠ", price: 80, type: 'piece', img: "" },
                { name: "ÙØ§Ø¯Ø¬", price: 55, type: 'piece', img: "" },
                { name: "Ù…ÙˆÙ„ØªÙ† ÙƒÙŠÙƒ", price: 55, type: 'piece', img: "" },
                { name: "Ø¯ÙˆÙ†ØªØ³", price: 40, type: 'piece', img: "" },
                { name: "Ø³ÙˆÙŠØ³ Ø±ÙˆÙ„", price: 100, type: 'piece', img: "" },
                { name: "Ø¯Ø³Ø¨Ø³ÙŠØªÙˆ ÙƒØ¨ÙŠØ±", price: 60, type: 'piece', img: "" },
                { name: "Ø¯Ø³Ø¨Ø³ÙŠØªÙˆ ØµØºÙŠØ±", price: 40, type: 'piece', img: "" },
                { name: "Ø§Ù†Ø¬Ù„Ø´ ÙƒÙŠÙƒ", price: 175, type: 'piece', img: "" },
                { name: "Ø¨ÙØªØ±ÙˆÙ„", price: 75, type: 'piece', img: "" },
                { name: "Ø³ÙŠÙ†Ø¨ÙˆÙ†", price: 45, type: 'piece', img: "" },
                { name: "ØªØ§Ø±Øª", price: 48, type: 'piece', img: "" },
                { name: "Ø§ÙƒÙ„ÙŠØ±", price: 45, type: 'piece', img: "" },
                { name: "Ø¬Ø§ØªÙˆ ÙƒÙ„Ø§Ø³ÙŠÙƒ", price: 25, type: 'piece', img: "" },
            ],
            offers: [
                { name: "Ø¹Ø±Ø¶ 1", price: 100, type: 'piece', img: "" },
                { name: "Ø¹Ø±Ø¶ 2", price: 200, type: 'piece', img: "" },
            ],
            drinks: [
                { name: "Ù…ÙŠØ§Ù‡ Ù…Ø¹Ø¯Ù†ÙŠØ©", price: 10, type: 'piece', img: "" },
                { name: "Ø´Ø§ÙŠ ÙƒØ§Ø±Ùƒ ØµØºÙŠØ±", price: 15, type: 'piece', img: "" },
                { name: "Ø´Ø§ÙŠ ÙƒØ§Ø±Ùƒ ÙƒØ¨ÙŠØ±", price: 25, type: 'piece', img: "" },
                { name: "Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ", price: 20, type: 'piece', img: "" },
                { name: "Ù‚Ù‡ÙˆÙ‡ Ø³Ø§Ø¯Ù‡", price: 20, type: 'piece', img: "" },
            ],
        };

        function loadDatabase() {
            const storedDB = JSON.parse(localStorage.getItem('oudelle_custom_database'));
            if (storedDB) {
                // Full state replacement for accurate sync (handles deletions)
                database = storedDB;
            }

            // Ensure defaults exist (in case of partial DB or new fields)
            ensureDefaults();
        }



        // Initial load
        if (isCloudActive) {
            // Cloud Mode: Listen to Firestore
            db.collection('app').doc('data').onSnapshot((doc) => {
                if (doc.exists) {
                    console.log("ğŸ”¥ Data received from Cloud");
                    database = doc.data();

                    // Re-apply defaults if needed
                    ensureDefaults();

                    // Full UI Sync
                    renderCategories();
                    render(currentCat);
                    renderBestSellers();
                    renderGallery();
                    syncUI();
                    
                    // Apply Ramadan mode from cloud
                    if (database.settings && database.settings.isRamadanMode !== undefined) {
                        isRamadanMode = database.settings.isRamadanMode;
                        localStorage.setItem('oudelle_ramadan', isRamadanMode);
                        document.body.classList.toggle('ramadan-mode', isRamadanMode);
                        const btn = document.getElementById('ramadan-toggle-btn');
                        if (btn) btn.innerText = isRamadanMode ? "Ø¥Ø¨Ø·Ø§Ù„" : "ØªÙØ¹ÙŠÙ„";
                    }

                    if (document.getElementById('adminModal').style.display === 'flex') {
                        renderAdmCategoriesList();
                        renderAdmTable();
                    }
                } else {
                    // First run: Create doc if empty
                    console.log("ğŸ”¥ Creating initial Cloud Database...");
                    saveAdminChanges();
                }
            });
        } else {
            // Local Mode: Standard Load
            loadDatabase();
        }

        function ensureDefaults() {
            if (!database.categories) {
                database.categories = [
                    { id: 'oriental', name: 'Ø§Ù„Ø´Ø±Ù‚ÙŠ' },
                    { id: 'nabulsia', name: 'Ù‚Ø³Ù… Ø§Ù„Ù†Ø§Ø¨Ù„Ø³ÙŠØ©' },
                    { id: 'dairy', name: 'Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¨Ø§Ù†' },
                    { id: 'jordanian', name: 'Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠ' },
                    { id: 'Westernsweets', name: 'Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª Ø§Ù„ØºØ±Ø¨ÙŠØ©' },
                    { id: 'offers', name: 'Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ©' },
                    { id: 'drinks', name: 'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª' }
                ];
            }
            if (!database.stats) database.stats = { totalOrders: 0, totalRevenue: 0 };
            if (!database.gallery) database.gallery = [];
            if (!database.orders) database.orders = [];
            if (!database.settings) database.settings = { whatsapp: WHATSAPP_NUM, ticker: TICKER_TEXT };
            if (!database.vouchers) database.vouchers = { 'OUDELLE10': 0.10, 'WELCOME': 0.05, 'OFF50': 0.50, 'OUDELLE2026': 0.10 };
            if (!database.delivery) database.delivery = [
                { name: "Ù†Ø¬Ø¹ Ø­Ù…Ø§Ø¯ÙŠ", price: 30 },
                { name: "Ø®Ø§Ø±Ø¬ Ù†Ø¬Ø¹ Ø­Ù…Ø§Ø¯ÙŠ", price: 40 },
                { name: "Ù‡Ùˆ", price: 50 },
                { name: "Ù…Ø¯ÙŠÙ†Ù‡ Ø§Ù„Ø§Ù„Ù…ÙˆÙ†ÙŠÙˆÙ…", price: 60 },
                { name: "Ù‚Ø±ÙŠÙ‡ Ø¨Ø±ÙƒÙ‡", price: 70 }
            ];
        }

        // Cross-tab Synchronization (Local Mode Only)
        window.addEventListener('storage', (e) => {
            if (!isCloudActive && e.key === 'oudelle_custom_database') {
                console.log("ğŸ”„ change detected, syncing...");
                loadDatabase();

                // Re-render Client UI
                renderCategories();
                // If the current category was deleted, switch to default
                if (!database.categories.find(c => c.id === currentCat)) {
                    currentCat = database.categories[0]?.id || 'oriental';
                }
                render(currentCat);
                renderBestSellers();
                renderGallery();
                syncUI(); // Updates theme, atmosphere, etc.

                // Update Admin UI if open
                if (document.getElementById('adminModal').style.display === 'flex') {
                    renderAdmCategoriesList(); // Sync category list in admin
                    renderAdmTabs();           // Sync category tabs in admin
                    // If admCurrentCat deleted, switch
                    if (!database.categories.find(c => c.id === admCurrentCat)) {
                        admCurrentCat = database.categories[0]?.id || 'oriental';
                        renderAdmTable();
                    } else {
                        renderAdmTable();
                    }
                    renderAdmVouchers();
                    renderAdmAreas();
                    renderAdmMixEditor();
                    renderAdmOrders();
                    renderStats();
                }
                
                // Show notification to clients
                showUpdateNotification();
            }
        });

        // Cross-tab sync using BroadcastChannel (modern browsers)
        let broadcastChannel = null;
        if (typeof BroadcastChannel !== 'undefined') {
            broadcastChannel = new BroadcastChannel('oudelle_sync');
            broadcastChannel.onmessage = (event) => {
                if (event.data.type === 'database_update') {
                    console.log(" Received update from another tab");
                    database = event.data.data;
                    renderCategories();
                    render(currentCat);
                    renderBestSellers();
                    renderGallery();
                    syncUI();
                }
            };
        }

        function saveAdminChanges() {
            localStorage.setItem('oudelle_custom_database', JSON.stringify(database));
            
            // Broadcast to other tabs
            if (broadcastChannel) {
                broadcastChannel.postMessage({
                    type: 'database_update',
                    data: database
                });
            }
            
            // Real-time sync for all connected clients via Firebase
            if (isCloudActive && db) {
                console.log(" Syncing to cloud...");
                db.collection('app').doc('data').set(database).then(() => {
                    console.log(" Changes synced to cloud!");
                    // Force refresh on other devices by updating timestamp
                    const timestamp = new Date().toISOString();
                    localStorage.setItem('oudelle_last_sync', timestamp);
                }).catch((error) => {
                    console.error(" Cloud sync error:", error);
                    alert(" Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·.");
                });
            } else {
                console.log(" Saved to localStorage only (cloud not available)");
            }
        }

        function showMenu() {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('menu-page').style.display = 'block';
            document.body.scrollTop = 0;
            renderCategories();
            render(currentCat);
            renderBestSellers();
            renderGallery();
        }

        function showHome() {
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('menu-page').style.display = 'none';
            document.body.scrollTop = 0;
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function searchProducts(q) {
            if (!q) return render(currentCat);
            let html = "";
            let found = false;
            const uploadedImages = JSON.parse(localStorage.getItem('oudelle_uploaded_images') || '{}');

            for (let cat in database) {
                if (cat === 'categories' || cat === 'stats' || cat === 'gallery' || cat === 'orders' || cat === 'settings' || cat === 'vouchers' || cat === 'delivery') continue;
                database[cat].forEach((p, i) => {
                    const isSoldOut = p.inStock === false;
                    const hasDiscount = p.isDiscount || (p.oldPrice && parseFloat(p.oldPrice) > parseFloat(p.price));
                    const discountHTML = hasDiscount ? `<div class="discount-status-badge">Ø¹Ø±Ø¶ Ø®Ø§Øµ / Ø®ØµÙ… </div>` : "";
                    if (p.name.toLowerCase().includes(q.toLowerCase())) {
                        found = true;
                        html += `
                            <div class="product-card">
                                <div class="product-image">
                                    <img src="${uploadedImages[p.img] || p.img}" alt="${p.name}">
                                </div>
                                <div class="product-info">
                                    <h3>${p.name}</h3>
                                    <p>${p.price} ${p.type}</p>
                                    ${discountHTML}
                                    ${isSoldOut ? '<div class="sold-out-badge">Ù†ÙØ°</div>' : ''}
                                </div>
                                <div class="product-actions">
                                    <button class="add-to-cart" onclick="addToCart('${cat}', ${i})">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
                                </div>
                            </div>
                        `;
                    }
                });
            }

            if (!found) {
                html = '<h2>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</h2>';
            }

            document.getElementById('products-container').innerHTML = html;
        }

        // Periodic sync check every 1 second for faster updates
        setInterval(() => {
            if (isCloudActive && db) {
                db.collection('app').doc('data').get().then((doc) => {
                    if (doc.exists) {
                        const newData = doc.data();
                        if (JSON.stringify(newData) !== JSON.stringify(database)) {
                            console.log(" Real-time sync: Update detected");
                            database = newData;
                            // Force complete UI refresh
                            ensureDefaults();
                            renderCategories();
                            render(currentCat);
                            renderBestSellers();
                            renderGallery();
                            
                            // Apply Ramadan mode from cloud immediately
                            if (database.settings && database.settings.isRamadanMode !== undefined) {
                                isRamadanMode = database.settings.isRamadanMode;
                                localStorage.setItem('oudelle_ramadan', isRamadanMode);
                                document.body.classList.toggle('ramadan-mode', isRamadanMode);
                                const btn = document.getElementById('ramadan-toggle-btn');
                                if (btn) btn.innerText = isRamadanMode ? "Ø¥Ø¨Ø·Ø§Ù„" : "ØªÙØ¹ÙŠÙ„";
                            }
                            
                            syncUI();
                            
                            // Show sync notification
                            console.log(" UI updated from cloud!");
                        }
                    }
                }).catch((error) => {
                    console.error("Sync error:", error);
                });
            }
        }, 1000);

        function openAdmin() {
            // Remove existing login modal if any
            const existingModal = document.querySelector('.admin-login-overlay');
            if (existingModal) existingModal.remove();
            
            // Create custom login modal
            const loginModal = document.createElement('div');
            loginModal.className = 'admin-login-overlay';
            loginModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                direction: rtl;
            `;
            
            loginModal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
                    <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">ğŸ›ï¸ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ù…Ù†</h2>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                        <input type="password" id="admin-pass-input" style="width: 100%; padding: 12px; border: 2px solid var(--gold); border-radius: 8px; font-size: 16px; text-align: center;" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autofocus>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="confirmAdminLogin()" style="flex: 1; background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">Ø¯Ø®ÙˆÙ„</button>
                        <button onclick="cancelAdminLogin()" style="flex: 1; background: #dc3545; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 16px;">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(loginModal);
            
            // Focus on password input
            setTimeout(() => {
                const passInput = document.getElementById('admin-pass-input');
                if (passInput) {
                    passInput.focus();
                    // Allow Enter key to submit
                    passInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            confirmAdminLogin();
                        }
                    });
                }
            }, 100);
        }

        function confirmAdminLogin() {
            const passInput = document.getElementById('admin-pass-input');
            const password = passInput ? passInput.value : '';
            
            if (password === "55555") {
                document.querySelector('.admin-login-overlay').remove();
                showAdminPanel();
                alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
            } else {
                passInput.style.borderColor = '#dc3545';
                passInput.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    passInput.style.borderColor = 'var(--gold)';
                    passInput.style.animation = '';
                }, 500);
            }
        }

        function cancelAdminLogin() {
            const loginModal = document.querySelector('.admin-login-overlay');
            if (loginModal) {
                loginModal.remove();
            }
        }

        function showAdminPanel() {
            document.getElementById('adminModal').style.display = 'flex';
            renderAdmTabs();
            renderAdmTable();
            renderAdmGallery();
            renderAdmVouchers();
            renderAdmAreas();
            renderStats();
            renderAdmOrders();
            renderAdmMixEditor();
            if (database.settings) {
                document.getElementById('adm-wa-num').value = database.settings.whatsapp;
                document.getElementById('adm-ticker-text').value = database.settings.ticker;
            }
            document.getElementById('ramadan-toggle-btn').innerText = isRamadanMode ? "Ø¥Ø¨Ø·Ø§Ù„" : "ØªÙØ¹ÙŠÙ„";
        }

        function resetRevenue() {
            if (confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!")) {
                database.stats.totalRevenue = 0;
                saveAdminChanges();
                renderStats();
                alert("âœ… ØªÙ… ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            }
        }

        function resetTotalOrders() {
            if (confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!")) {
                database.orders = [];
                database.stats.totalOrders = 0;
                localStorage.setItem('oudelle_order_counter', 0);
                saveAdminChanges();
                renderStats();
                renderAdmOrders();
                alert("âœ… ØªÙ… ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            }
        }

        function clearAllOrders() {
            if (confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!")) {
                database.orders = [];
                saveAdminChanges();
                renderAdmOrders();
                alert("âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            }
        }

        function renderAdmTabs() {
            const tabsDiv = document.getElementById('adm-category-tabs');
            if (tabsDiv && database.categories) {
                tabsDiv.innerHTML = database.categories.map(c => `
                    <button class="admin-tab-btn ${c.id === admCurrentCat ? 'active' : ''}" 
                            onclick="switchAdmCat('${c.id}')">
                        ${c.name}
                    </button>
                `).join('');
            }
        }

        function switchAdmCat(cat) {
            admCurrentCat = cat;
            renderAdmTabs();

            renderAdmTable();
            render(cat);
        }

        function syncUI() {
            // Update Global Settings
            if (database.settings) {
                WHATSAPP_NUM = database.settings.whatsapp;
                TICKER_TEXT = database.settings.ticker;
                const tickerEl = document.querySelector('.ticker');
                if (tickerEl) tickerEl.innerText = TICKER_TEXT;
            }

            // Render Client Views (ensure immediate local update)
            renderCategories();
            render(currentCat);
            renderBestSellers();
            const sky = document.getElementById('sky-overlay');
            if (sky && sky.children.length === 0) {
                for (let i = 0; i < 80; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    const size = Math.random() * 2 + 1;
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    star.style.animation = `twinkle ${2 + Math.random() * 3}s infinite alternate`;
                    sky.appendChild(star);
                }
            }
            updateAtmosphere();
            if (!window.ramadanInterval) {
                window.ramadanInterval = setInterval(updateAtmosphere, 1000);
            }
        }

        function updateAtmosphere() {
            if (!isRamadanMode) {
                if (window.ramadanInterval) {
                    clearInterval(window.ramadanInterval);
                    window.ramadanInterval = null;
                }
                return;
            }
            const now = new Date();
            const maghrib = new Date();
            maghrib.setHours(18, 15, 0); // Estimated Iftar for Naga Hammadi
            const diff = maghrib - now;
            const timer = document.getElementById('iftar-countdown');
            const stars = document.querySelectorAll('.star');
            const compass = document.getElementById('ramadan-compass');

            if (diff > 0) {
                const hours = Math.floor(diff / 3600000);
                const mins = Math.floor((diff % 3600000) / 60000);
                const secs = Math.floor((diff % 60000) / 1000);
                timer.innerHTML = `${hours}h ${mins}m<br>Ø¹Ù„Ù‰ Ø§Ù„Ù…ØºØ±Ø¨`;
                const twoHours = 2 * 60 * 60 * 1000;
                if (diff < twoHours) {
                    const progress = 1 - (diff / twoHours);
                    if (progress > 0.5) document.body.classList.add('night-time');
                    stars.forEach(s => s.style.opacity = progress.toFixed(2));
                }
            } else {
                timer.innerHTML = "ØµÙˆÙ…Ø§Ù‹ Ù…Ù‚Ø¨ÙˆÙ„Ø§Ù‹<br>ÙˆØ¥ÙØ·Ø§Ø±Ø§Ù‹ Ø´Ù‡ÙŠØ§Ù‹";
                document.body.classList.add('night-time');
                stars.forEach(s => s.style.opacity = '1');
                if (compass) compass.style.borderColor = "#4ade80";
            }
        }

        function showIftarInfo() {
            alert("Ø¨ÙˆØµÙ„Ø© Ø£ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ© âœ¨\nØªÙ‚ÙˆÙ… Ø¨Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙÙŠ Ù†Ø¬Ø¹ Ø­Ù…Ø§Ø¯ÙŠ ÙˆØªÙ†Ø¨ÙŠÙ‡Ùƒ Ø¨Ø§Ù‚ØªØ±Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ù…ØºØ±Ø¨!");
        }

        // --- Advanced Engagement Features Logic ---
        let appliedDiscount = 0;
        const validVouchers = { 'OUDELLE10': 0.10, 'WELCOME': 0.05, 'OFF50': 0.50, 'OUDELLE2026': 0.10 };

        function surpriseMe() {
            const allProducts = [];
            for (let cat in database) {
                if (database[cat]) {
                    database[cat].forEach(p => { if (!p.isMix && p.inStock !== false) allProducts.push({ ...p, cat }); });
                }
            }
            if (allProducts.length === 0) return;
            const randomP = allProducts[Math.floor(Math.random() * allProducts.length)];

            // Highlight the product
            showMenu();
            render(randomP.cat);
            alert(`âœ¨ Ø¬Ø±Ø¨Ù†Ø§ Ù†Ø®ØªØ§Ø±Ù„Ùƒ: ${randomP.name}! âœ¨\nØ¥ÙŠÙ‡ Ø±Ø£ÙŠÙƒØŸ`);

            // Scroll to it
            setTimeout(() => {
                const cards = document.querySelectorAll('.card');
                cards.forEach(c => {
                    if (c.innerText.includes(randomP.name)) {
                        c.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        c.style.boxShadow = "0 0 30px var(--gold)";
                        setTimeout(() => c.style.boxShadow = "var(--shadow)", 3000);
                    }
                });
            }, 500);
        }

        function applyVoucher() {
            const code = document.getElementById('v-code').value.toUpperCase();
            const msg = document.getElementById('v-msg');
            const vouchers = database.vouchers || {};
            if (vouchers[code]) {
                appliedDiscount = vouchers[code];
                msg.innerText = `âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… ${(appliedDiscount * 100)}%`;
                msg.style.color = "green";
                updateTotal();
            } else {
                appliedDiscount = 0;
                msg.innerText = "âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­";
                msg.style.color = "red";
                updateTotal();
            }
        }

        function callWaiter() {
            if (!selectedTableNumber) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø£ÙˆÙ„Ø§Ù‹");
            const text = `ğŸ”” *Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø©*\\n*Ø·Ø§ÙˆÙ„Ø© Ø±Ù‚Ù…:* ${selectedTableNumber}\\nØ§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ·Ù„Ø¨ Ø§Ù„Ø¬Ø±Ø³ÙˆÙ†.`;
            window.open(`https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent(text)}`);
        }


        function render(cat, btn) {
            currentCat = cat;
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
                if (t.getAttribute('onclick')?.includes(`'${cat}'`)) t.classList.add('active');
            });

            let html = "";
            let itemsWithIndex = database[cat]
                .map((p, index) => ({ ...p, index }))
                .sort((a, b) => (a.isMix === b.isMix ? 0 : a.isMix ? 1 : -1));

            if (itemsWithIndex.length === 0) {
                document.getElementById('product-grid').innerHTML = "<p style='text-align:center; width:100%; padding:20px;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>";
                return;
            }

            const uploadedImages = JSON.parse(localStorage.getItem('oudelle_uploaded_images') || '{}');
            itemsWithIndex.forEach((p) => {
                const i = p.index;
                const isSoldOut = p.inStock === false;
                const isVIP = p.isVIP || false;
                const hasDiscount = p.isDiscount || (p.oldPrice && parseFloat(p.oldPrice) > parseFloat(p.price));
                const discountHTML = hasDiscount ? `<div class="discount-status-badge">Ø¹Ø±Ø¶ Ø®Ø§Øµ / Ø®ØµÙ… ğŸ·ï¸</div>` : "";

                // Check if image exists in uploaded images or use placeholder
                let img = p.img || `https://via.placeholder.com/300x200?text=${p.name}`;
                if (p.img && uploadedImages[p.img]) {
                    img = uploadedImages[p.img];
                }

                const vipHTML = isVIP ? `<div class="vip-badge">Ø§Ù„Ø´ÙŠÙ ÙŠØ±Ø´Ø­Ù‡ ğŸ‘‘</div>` : "";


                if (p.isMix) {
                    const sourceItems = p.contents ? p.contents.map(name => {
                        for (let c in database) {
                            let found = database[c].find(x => x.name === name);
                            if (found) return found;
                        }
                        return null;
                    }).filter(x => x) : database[p.source].filter(x => !x.isMix);

                    html += `<div class="card ${isSoldOut ? 'sold-out' : ''}" style="grid-column: 1/-1; background: var(--primary); color: white; position:relative;">${discountHTML}${vipHTML}<h3 style="color: white;">${p.title}</h3>` +
                        sourceItems.map(sub => `<div style="display:flex; justify-content:space-between; padding:5px; color: white;">${sub.name}<input type="number" class="mix-sub" data-name="${sub.name}" data-price="${sub.price}" style="width:60px" placeholder="Ø¬Ù…"></div>`).join('') + `<button class="hero-btn" style="box-shadow:none; margin-top:10px; font-size:1rem; color: white; border: 1px solid white;" onclick="addMix('${p.title}')" ${isSoldOut ? 'disabled' : ''}>${isSoldOut ? 'ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹' : 'Ø¥Ø¶Ø§ÙØ©'}</button></div>`;
                } else {
                    const optionsHTML = (p.options && p.options.length)
                        ? `<select id="o-${cat}-${i}" class="weight-select" ${isSoldOut ? 'disabled' : ''}>${p.options.map(o => `<option value="${o}">${o}</option>`).join('')}</select>`
                        : "";

                    if (p.type === 'kg') {
                        let displayPrice = (p.price / 4).toFixed(2);
                        let oldDisplayPrice = p.oldPrice ? (p.oldPrice / 4).toFixed(2) : null;
                        const oldPriceHTML = oldDisplayPrice ? `<div class="old-price-display"><span class="price-strike-small">${oldDisplayPrice} Ø¬</span></div>` : "";
                        let unit = 'Ø¬/Ø±Ø¨Ø¹ ÙƒÙŠÙ„Ùˆ';
                        let weightOptions = `<option value="0.25">250Ø¬Ù…</option><option value="0.5">500Ø¬Ù…</option><option value="1" selected>1 ÙƒÙŠÙ„Ùˆ</option>`;
                        html += `<div class="card ${isSoldOut ? 'sold-out' : ''}" style="position:relative;">${vipHTML}<img src="${img}"><h3>${p.name}</h3>` +
                            (isSoldOut ? `<span class="out-of-stock-badge">ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹</span>` : `${discountHTML}${oldPriceHTML}<span class="price-badge">${displayPrice} ${unit}</span>`) +
                            `${optionsHTML}<select id="w-${cat}-${i}" class="weight-select" ${isSoldOut ? 'disabled' : ''}>${weightOptions}</select><button class="add-btn" onclick="addKg('${cat}',${i})" ${isSoldOut ? 'disabled' : ''}>${isSoldOut ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : 'Ø¥Ø¶Ø§ÙØ©'}</button></div>`;
                    } else {
                        const oldPriceHTML = p.oldPrice ? `<div class="old-price-display"><span class="price-strike-small">${p.oldPrice} Ø¬</span></div>` : "";
                        html += `<div class="card ${isSoldOut ? 'sold-out' : ''}" style="position:relative;">${vipHTML}<img src="${img}"><h3>${p.name}</h3>` +
                            (isSoldOut ? `<span class="out-of-stock-badge">ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹</span>` : `${discountHTML}${oldPriceHTML}<span class="price-badge">${p.price} Ø¬.Ù…</span>`) +
                            `${optionsHTML}<input type="number" id="q-${cat}-${i}" class="weight-select" value="1" min="1" ${isSoldOut ? 'disabled' : ''}><button class="add-btn" onclick="addPiece('${cat}',${i})" ${isSoldOut ? 'disabled' : ''}>${isSoldOut ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : 'Ø¥Ø¶Ø§ÙØ©'}</button></div>`;
                    }
                }
            });
            document.getElementById('product-grid').innerHTML = html;
        }

        // Update checkout to show progress and reset discount
        function checkout() {
            const name = document.getElementById('c-name').value, meth = document.getElementById('del-method').value;
            if (!name) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨");
            if (meth !== 'dinein' && !confirm("Ù‡Ù„ Ù‚Ù…Øª Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØªØµÙˆÙŠØ± Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©ØŸ")) return;

            let orderNum = localStorage.getItem('oudelle_order_counter') || 0;
            orderNum = parseInt(orderNum) + 1;
            localStorage.setItem('oudelle_order_counter', orderNum);

            // --- Structured WhatsApp Template ---
            let text = `ğŸŒŸ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø£ÙˆØ¯ÙŠÙ„* ğŸŒŸ\n`;
            text += `------------------------------------------\n`;
            text += `ğŸ“¦ *Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø±: #${orderNum}* ğŸ“¦\n`;
            text += `------------------------------------------\n\n`;

            text += `ğŸ‘¤ *Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:*\n`;
            text += `â€¢ Ø§Ù„Ø§Ø³Ù…: ${name}\n`;
            if (meth !== 'dinein') {
                text += `â€¢ Ø§Ù„Ù‡Ø§ØªÙ: ${document.getElementById('c-phone').value}\n`;
            }
            text += `\n`;

            text += `ğŸ“ *ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:*\n`;
            const methAr = (meth === 'delivery') ? 'ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„ ğŸ ' : (meth === 'pickup' ? 'Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹ ğŸ¥¯' : 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø·Ø¹Ù… ğŸ½ï¸');
            text += `â€¢ Ø§Ù„Ù†ÙˆØ¹: ${methAr}\n`;

            if (meth === 'dinein') {
                text += `â€¢ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: ${selectedTableNumber}\n`;
            } else {
                text += `â€¢ Ø§Ù„Ø¯ÙØ¹: InstaPay âœ…\n`;
                if (meth === 'delivery') {
                    text += `â€¢ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${document.getElementById('c-addr').value}\n`;
                }
            }

            const ordDate = document.getElementById('order-date').value;
            const ordTime = document.getElementById('order-time').value;
            if (ordDate || ordTime) {
                text += `â€¢ Ø§Ù„Ù…ÙˆØ¹Ø¯: ${ordDate || 'Ø§Ù„ÙŠÙˆÙ…'} ÙÙŠ ${ordTime || 'Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª'}\n`;
            }
            text += `\n`;

            text += `ğŸ§ *Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:*\n`;
            text += cart.map(it => `â€¢ ${it.name} â€” ${it.price.toFixed(2)} Ø¬`).join('\n');
            text += `\n\n`;

            text += `ğŸ’° *Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:*\n`;
            const subtotal = cart.reduce((s, it) => s + it.price, 0);
            text += `â€¢ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${subtotal.toFixed(2)} Ø¬\n`;
            if (appliedDiscount > 0) {
                text += `â€¢ Ø§Ù„Ø®ØµÙ…: ${(appliedDiscount * 100)}%\n`;
            }

            if (meth === 'delivery') {
                const shipping = parseInt(document.getElementById('area-select').value);
                text += `â€¢ Ø§Ù„ØªÙˆØµÙŠÙ„: ${shipping} Ø¬\n`;
            }

            text += `\nğŸ’µ *Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¯ÙØ¹Ù‡: ${document.getElementById('total-price').innerText}* ğŸ’µ\n`;
            text += `------------------------------------------\n`;
            text += `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø£ÙˆØ¯ÙŠÙ„! â¤ï¸âœ¨`;

            database.stats.totalOrders++;
            database.stats.totalRevenue += subtotal;

            const orderDetails = {
                num: orderNum,
                name: name,
                phone: document.getElementById('c-phone').value,
                addr: document.getElementById('c-addr').value,
                meth: meth,
                table: selectedTableNumber,
                items: JSON.parse(JSON.stringify(cart)),
                subtotal: subtotal,
                discount: appliedDiscount,
                shipping: (meth === 'delivery') ? parseInt(document.getElementById('area-select').value) : 0,
                total: parseFloat(document.getElementById('total-price').innerText.replace(/[^0-9.]/g, '')),
                date: new Date().toLocaleString('ar-EG'),
                scheduled: { date: document.getElementById('order-date').value, time: document.getElementById('order-time').value }
            };
            database.orders.unshift(orderDetails);
            if (database.orders.length > 50) database.orders.pop();

            saveAdminChanges();

            const waUrl = `https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent(text)}`;
            showOrderAnimation(waUrl);

            // Show Simulation
            showCart(); // close cart
            cart = []; localStorage.removeItem('oudelle_cart'); renderCart(); // Clear cart after order
        }

        function showOrderAnimation(url) {
            const overlay = document.getElementById('order-success-overlay');
            const confettiCont = document.getElementById('confetti-container');
            overlay.style.display = 'flex';

            // Create luxurious particles (gold/white)
            confettiCont.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const p = document.createElement('div');
                p.style.position = 'absolute';
                p.style.width = Math.random() * 8 + 4 + 'px';
                p.style.height = p.style.width;
                p.style.background = Math.random() > 0.5 ? '#fbbf24' : '#ffffff';
                p.style.borderRadius = '50%';
                p.style.left = Math.random() * 100 + '%';
                p.style.top = '-10%';
                p.style.opacity = Math.random();
                p.style.transition = `all ${2 + Math.random() * 3}s linear`;
                confettiCont.appendChild(p);

                setTimeout(() => {
                    p.style.top = '110%';
                    p.style.left = (parseFloat(p.style.left) + (Math.random() * 20 - 10)) + '%';
                    p.style.transform = `rotate(${Math.random() * 360}deg)`;
                }, 100);
            }

            // Redirect after animation stages (approx 5s)
            window.pendingWaUrl = url;
            const fallbackBtn = document.getElementById('wa-fallback-btn');

            setTimeout(() => {
                fallbackBtn.style.display = 'inline-block';
                window.location.href = url;
            }, 5500);

            // Hide overlay after return (or after a long timeout)
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                    overlay.style.opacity = '1';
                }, 1000);
            }, 8000);
        }

        function updateTotal() {
            const subtotal = cart.reduce((s, it) => s + it.price, 0);
            const areaSel = document.getElementById('area-select');
            let shipping = (document.getElementById('del-method').value === 'delivery' && areaSel) ? parseInt(areaSel.value) : 0;
            const total = (subtotal + shipping) * (1 - appliedDiscount);
            document.getElementById('total-price').innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø¬.Ù…`;
        }

        function toggleFields() {
            const m = document.getElementById('del-method').value;
            document.getElementById('dinein-field').classList.toggle('hidden', m !== 'dinein');
            document.getElementById('waiter-field').classList.toggle('hidden', m !== 'dinein');
            document.getElementById('delivery-field').classList.toggle('hidden', m !== 'delivery');
            document.getElementById('phone-field').classList.toggle('hidden', m === 'dinein');
            document.getElementById('instapay-ui').style.display = (m === 'dinein') ? 'none' : 'block';

            // Show scheduling button only for delivery/pickup
            const showToggle = (m === 'delivery' || m === 'pickup');
            document.getElementById('schedule-toggle-container').classList.toggle('hidden', !showToggle);

            // Auto-hide schedule fields when changing method
            document.getElementById('schedule-field').classList.add('hidden');

            updateTotal();
        }

        function toggleSchedule() {
            const field = document.getElementById('schedule-field');
            field.classList.toggle('hidden');
            if (!field.classList.contains('hidden')) {
                field.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // --- Admin Enhancements for Advanced Features ---
        function renderAdmTable() {
            const tableBody = document.getElementById('adm-items-table');
            const items = database[admCurrentCat] || [];

            tableBody.innerHTML = items.map((p, index) => `
                <tr>
                    <td><img src="${p.img || 'https://via.placeholder.com/50'}" style="width:40px; height:40px; object-fit:cover; border-radius:5px;"></td>
                    <td>${p.isMix ? p.title : p.name}</td>
                    <td>
                        ${p.isMix ? '---' : `<input type="number" value="${p.price}" 
                                style="width:70px; padding:3px; border:1px solid #ddd; border-radius:5px;"
                                onchange="admUpdateCurrentPrice('${admCurrentCat}', ${index}, this.value)"> Ø¬`}
                    </td>
                    <td>
                        ${p.isMix ? '---' : `<input type="number" value="${p.oldPrice || ''}"
                                style="width:70px; padding:3px; border:1px solid #ddd; border-radius:5px;"
                                onchange="admUpdateOldPrice('${admCurrentCat}', ${index}, this.value)"> Ø¬`}
                    </td>
                    <td>${p.isMix ? 'Ù…ÙƒØ³' : (p.type === 'kg' ? 'ÙƒÙŠÙ„Ùˆ' : 'Ù‚Ø·Ø¹Ø©')}</td>
                    <td>${p.isMix ? '---' : (p.options && p.options.length ? `(Ù…ØªØ¹Ø¯Ø¯)` : 'Ø³Ø§Ø¯Ù‡')}</td>
                    <td>
                        <button class="admin-btn" style="width:auto; padding:2px 8px; background:${p.isBestSeller ? '#ff9800' : '#ccc'};"
                                onclick="admToggleBestSeller('${admCurrentCat}', ${index})">ğŸ”¥ Ø§Ù„Ø£ÙƒØ«Ø±</button>
                        <button class="admin-btn" style="width:auto; padding:2px 8px; background:${p.isVIP ? 'gold' : '#ccc'}; margin-top:3px;"
                                onclick="admToggleVIP('${admCurrentCat}', ${index})">ğŸ‘‘ VIP</button>
                        <button class="admin-btn" style="width:auto; padding:2px 8px; background:${p.isDiscount ? '#d32f2f' : '#ccc'}; margin-top:3px; color:${p.isDiscount ? 'white' : 'black'};"
                                onclick="admToggleDiscount('${admCurrentCat}', ${index})">ğŸ·ï¸ Ø®ØµÙ…</button>
                        <button class="admin-btn" style="width:auto; padding:2px 8px; background:#2196f3; margin-top:3px; color:white;"
                                onclick="admEditProduct('${admCurrentCat}', ${index})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                    </td>
                    <td>
                        <button class="admin-btn" style="width:auto; padding:2px 8px; background:${p.inStock !== false ? '#4ade80' : '#ff4444'};"
                                onclick="admToggleStock('${admCurrentCat}', ${index})">
                            ${p.inStock !== false ? 'Ù…ØªÙˆÙØ±' : 'Ù…Ù†ØªÙ‡ÙŠ'}
                        </button>
                    </td>
                    <td>
                        <button class="admin-btn" style="width:auto; padding:2px 8px; background:#ef4444;" 
                                onclick="admDeleteProduct('${admCurrentCat}', ${index})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        function admToggleVIP(cat, idx) {
            database[cat][idx].isVIP = !database[cat][idx].isVIP;
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function admToggleStock(cat, index) {
            database[cat][index].inStock = !(database[cat][index].inStock !== false);
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function admDeleteProduct(cat, index) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
            database[cat].splice(index, 1);
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function admSaveSettings() {
            const wa = document.getElementById('adm-wa-num').value;
            const ticker = document.getElementById('adm-ticker-text').value;
            if (!wa) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨");
            database.settings.whatsapp = wa;
            database.settings.ticker = ticker;
            WHATSAPP_NUM = wa;
            TICKER_TEXT = ticker;
            const tickerEl = document.querySelector('.ticker');
            if (tickerEl) tickerEl.innerText = ticker;
            saveAdminChanges();
            alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
        }

        function renderAdmVouchers() {
            const list = document.getElementById('adm-vouchers-list');
            const v = database.vouchers || {};
            list.innerHTML = Object.entries(v).map(([code, perc]) => `
                <div style="background:#e0f2fe; padding:5px 10px; border-radius:15px; display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                    <b>${code}</b> (${perc * 100}%)
                    <button onclick="admRemoveVoucher('${code}')" style="border:none; background:none; color:red; cursor:pointer;">âœ–</button>
                </div>
            `).join('');
        }

        function admAddVoucher() {
            const code = document.getElementById('adm-v-code').value.toUpperCase();
            const perc = parseFloat(document.getElementById('adm-v-perc').value) / 100;
            if (!code || isNaN(perc)) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©");
            database.vouchers[code] = perc;
            saveAdminChanges();
            renderAdmVouchers();
            document.getElementById('adm-v-code').value = '';
            document.getElementById('adm-v-perc').value = '';
        }

        function admRemoveVoucher(code) {
            delete database.vouchers[code];
            saveAdminChanges();
            renderAdmVouchers();
        }

        function renderAdmAreas() {
            const list = document.getElementById('adm-areas-list');
            const areas = database.delivery || [];
            list.innerHTML = areas.map((a, i) => `
                <div style="background:#fef3c7; padding:5px 10px; border-radius:15px; display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                    <b>${a.name}</b> (${a.price}Ø¬)
                    <button onclick="admRemoveArea(${i})" style="border:none; background:none; color:red; cursor:pointer;">âœ–</button>
                </div>
            `).join('');

            // Update the actual select in cart
            const select = document.getElementById('area-select');
            if (select) {
                select.innerHTML = areas.map(a => `<option value="${a.price}">${a.name}</option>`).join('');
            }
        }

        function admAddArea() {
            const name = document.getElementById('adm-area-name').value;
            const price = parseInt(document.getElementById('adm-area-price').value);
            if (!name || isNaN(price)) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©");
            database.delivery.push({ name, price });
            saveAdminChanges();
            renderAdmAreas();
            document.getElementById('adm-area-name').value = '';
            document.getElementById('adm-area-price').value = '';
        }

        function admRemoveArea(i) {
            database.delivery.splice(i, 1);
            saveAdminChanges();
            renderAdmAreas();
        }

        function admToggleDiscount(cat, index) {
            database[cat][index].isDiscount = !database[cat][index].isDiscount;
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function admAddProduct() {
            const cat = document.getElementById('adm-cat').value;
            const name = document.getElementById('adm-name').value;
            const price = parseFloat(document.getElementById('adm-price').value);
            const oldPriceValue = document.getElementById('adm-old-price').value;
            const oldPrice = oldPriceValue ? parseFloat(oldPriceValue) : null;
            const type = document.getElementById('adm-type').value;
            const optionsStr = document.getElementById('adm-type-custom').value;
            const img = document.getElementById('adm-img').value;
            const editIndex = parseInt(document.getElementById('adm-edit-mode-index').value);

            if (!name || isNaN(price)) return alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

            const options = optionsStr ? optionsStr.split('\n').map(s => s.trim()).filter(s => s) : null;

            if (editIndex >= 0) {
                // Update Existing
                const p = database[cat][editIndex];
                p.name = name;
                p.price = price;
                p.oldPrice = oldPrice;
                p.type = type;
                p.options = options;
                p.img = img;
                alert("âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
            } else {
                // Add New
                const newP = { name, price, oldPrice, type, options, img: img || "", inStock: true, isDiscount: false, isVIP: false };
                if (!database[cat]) database[cat] = [];
                database[cat].unshift(newP);
                alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
            }

            saveAdminChanges();
            admCancelEdit(); // Reset form
            renderAdmTable();
            syncUI();
        }

        function admEditProduct(cat, index) {
            const p = database[cat][index];
            if (!p) return;

            document.getElementById('adm-cat').value = cat;
            document.getElementById('adm-cat').disabled = true;
            document.getElementById('adm-name').value = p.name;
            document.getElementById('adm-price').value = p.price;
            document.getElementById('adm-old-price').value = p.oldPrice || '';
            document.getElementById('adm-type').value = p.type;
            document.getElementById('adm-type-custom').value = p.options ? p.options.join('\n') : '';
            document.getElementById('adm-img').value = p.img || '';

            document.getElementById('adm-edit-mode-index').value = index;
            document.getElementById('adm-action-btn').innerText = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ğŸ’¾";
            document.getElementById('adm-action-btn').style.background = "#2196f3";
            document.getElementById('adm-cancel-edit-btn').style.display = "inline-block";

            // Scroll to form
            document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
        }

        function admCancelEdit() {
            document.getElementById('adm-cat').disabled = false;
            document.getElementById('adm-name').value = '';
            document.getElementById('adm-price').value = '';
            document.getElementById('adm-old-price').value = '';
            document.getElementById('adm-type-custom').value = '';
            document.getElementById('adm-img').value = '';
            document.getElementById('adm-edit-mode-index').value = '-1';

            const btn = document.getElementById('adm-action-btn');
            btn.innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬";
            btn.style.background = "var(--primary)";
            document.getElementById('adm-cancel-edit-btn').style.display = "none";
        }

        function admUpdateOptions(cat, index, val) {
            database[cat][index].options = val ? val.split('\n').map(s => s.trim()).filter(s => s) : null;
            saveAdminChanges();
            syncUI();
        }

        function admUpdateOldPrice(cat, index, val) {
            const v = parseFloat(val);
            database[cat][index].oldPrice = isNaN(v) ? null : v;
            saveAdminChanges();
            syncUI();
        }

        function admUpdateCurrentPrice(cat, index, val) {
            const v = parseFloat(val);
            if (!isNaN(v)) {
                database[cat][index].price = v;
                saveAdminChanges();
                syncUI();
            }
        }

        // --- Category Management ---
        function renderCategories() {
            const container = document.getElementById('category-tabs-container');
            if (!container) return;
            container.innerHTML = (database.categories || []).map(c => `
                <button class="tab ${c.id === currentCat ? 'active' : ''}" onclick="render('${c.id}', this)">${c.name}</button>
            `).join('');
        }

        function renderAdmCategoriesList() {
            const list = document.getElementById('adm-cats-list');
            if (!list) return;
            list.innerHTML = (database.categories || []).map((c, i) => `
                <div style="background:#e0f2fe; padding:5px 10px; border-radius:15px; display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                    <b>${c.name}</b>
                    ${['oriental', 'nabulsia', 'dairy', 'jordanian', 'Westernsweets', 'offers', 'drinks'].includes(c.id) ? '' : `<button onclick="admDeleteCategory(${i})" style="border:none; background:none; color:red; cursor:pointer;">âœ–</button>`}
                </div>
            `).join('');

            // Update Admin Select
            const sel = document.getElementById('adm-cat');
            if (sel) {
                sel.innerHTML = (database.categories || []).map(c => `<option value="${c.id}" ${c.id === admCurrentCat ? 'selected' : ''}>${c.name}</option>`).join('');
            }
        }

        function admAddCategory() {
            const name = document.getElementById('adm-new-cat-name').value;
            const id = document.getElementById('adm-new-cat-id').value.toLowerCase().replace(/[^a-z0-9]/g, '');
            if (!name || !id) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆÙƒÙˆØ¯ ØµØ­ÙŠØ­ Ù„Ù„Ù‚Ø³Ù…");
            if (database.categories.find(c => c.id === id)) return alert("Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„");

            database.categories.push({ id, name });
            database[id] = []; // Initialize empty array for products
            saveAdminChanges();
            document.getElementById('adm-new-cat-name').value = '';
            document.getElementById('adm-new-cat-id').value = '';
            syncUI();
            alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­");
        }

        function admDeleteCategory(index) {
            const cat = database.categories[index];
            if (!cat) return;
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‚Ø³Ù… "${cat.name}" ÙˆÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯Ø§Ø®Ù„Ù‡ØŸ`)) {
                delete database[cat.id]; // Remove products
                database.categories.splice(index, 1);
                // Reset current cat if deleted
                if (currentCat === cat.id) currentCat = database.categories[0].id;
                if (admCurrentCat === cat.id) admCurrentCat = database.categories[0].id;

                saveAdminChanges();
                document.getElementById('stat-revenue').innerText = database.stats.totalRevenue.toFixed(0) + " Ø¬";

                // Top 5 Products by volume (simulated as we don't have order details history, but we can show products with isBestSeller for now)
                let best = [];
                for (let cat in database) {
                    if (Array.isArray(database[cat])) {
                        database[cat].forEach(p => { if (p.isBestSeller) best.push(p.name); });
                    }
                }
                const topList = best.slice(0, 5).join(', ') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹';
                const revenueCard = document.querySelector('.admin-stats-bar');
                if (revenueCard && !document.getElementById('top-products-stat')) {
                    const topDiv = document.createElement('div');
                    topDiv.id = 'top-products-stat';
                    topDiv.className = 'stat-card';
                    topDiv.style.gridColumn = '1 / -1';
                    topDiv.style.marginTop = '10px';
                    topDiv.innerHTML = `<p style="font-size:0.8rem; color:#666;">Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ…ÙŠØ²Ø§Ù‹ ğŸ”¥</p><div class="stat-val" style="font-size:1.1rem; color:var(--gold);">${topList}</div>`;
                    revenueCard.appendChild(topDiv);
                } else if (document.getElementById('top-products-stat')) {
                    document.getElementById('top-products-stat').querySelector('.stat-val').innerText = topList;
                }
            }
        }

        function toggleRamadanMode() {
            isRamadanMode = !isRamadanMode;
            // Save to database for cloud sync
            if (!database.settings) database.settings = {};
            database.settings.isRamadanMode = isRamadanMode;
            saveAdminChanges();
            document.getElementById('ramadan-toggle-btn').innerText = isRamadanMode ? "Ø¥Ø¨Ø·Ø§Ù„" : "ØªÙØ¹ÙŠÙ„";
            document.body.classList.toggle('ramadan-mode', isRamadanMode);
            syncUI();
        }

        function admAddGallery() {
            const url = document.getElementById('adm-gallery-url').value;
            if (!url) return;
            database.gallery.push(url);
            document.getElementById('adm-gallery-url').value = '';
            saveAdminChanges();
            renderAdmGallery();
            syncUI();
        }

        function admDeleteGallery(i) {
            database.gallery.splice(i, 1);
            saveAdminChanges();
            renderAdmGallery();
            syncUI();
        }

        function renderAdmGallery() {
            const list = document.getElementById('adm-gallery-list');
            if (list) {
                list.innerHTML = (database.gallery || []).map((url, i) => `
            <div style="position:relative; flex-shrink:0;">
                <img src="${url}" style="width:50px; height:50px; object-fit:cover; border-radius:5px;">
                    <button onclick="admDeleteGallery(${i})" style="position:absolute; top:0; right:0; background:red; color:white; border:none; border-radius:50%; width:18px; height:18px; cursor:pointer; font-size:10px;">Ã—</button>
                </div>
        `).join('');
            }
        }

        function renderGallery() {
            const cont = document.getElementById('customer-gallery');
            if (cont) {
                cont.innerHTML = (database.gallery || []).map(url => `
            <div class="gallery-item animate__animated animate__zoomIn">
                <img src="${url}" loading="lazy">
                </div>
        `).join('');
            }
        }

        function admToggleBestSeller(cat, index) {
            database[cat][index].isBestSeller = !database[cat][index].isBestSeller;
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function admToggleVIP(cat, index) {
            database[cat][index].isVIP = !database[cat][index].isVIP;
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function renderBestSellers() {
            let all = [];
            for (let cat in database) {
                if (Array.isArray(database[cat])) {
                    database[cat].forEach(p => { if (p.isBestSeller) all.push(p); });
                }
            }
            const sec = document.getElementById('best-sellers-section');
            if (all.length > 0) {
                sec.classList.remove('hidden');
                const uploadedImages = JSON.parse(localStorage.getItem('oudelle_uploaded_images') || '{}');
                document.getElementById('best-sellers-grid').innerHTML = all.map(p => {
                    // Check if image exists in uploaded images or use placeholder
                    let imgSrc = p.img || 'https://via.placeholder.com/80';
                    if (p.img && uploadedImages[p.img]) {
                        imgSrc = uploadedImages[p.img];
                    }
                    return `
            <div class="best-seller-item" onclick="showMenu(); document.querySelector('.search-bar').value='${p.name}'; searchProducts('${p.name}')">
                <img src="${imgSrc}">
                    <p style="font-size:0.8rem; margin-top:5px; font-weight:bold;">${p.name}</p>
                </div>
                `;
                }).join('');
            } else {
                sec.classList.add('hidden');
            }
        }

        function admToggleStock(cat, index) {
            database[cat][index].inStock = !(database[cat][index].inStock !== false);
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        function admDeleteProduct(cat, index) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
            database[cat].splice(index, 1);
            saveAdminChanges();
            renderAdmTable();
            syncUI();
        }

        // --- Order History & Receipts ---
        function renderAdmOrders() {
            const list = document.getElementById('adm-orders-list');
            if (!list) return;
            const orders = (database.orders || []).slice().reverse().slice(0, 50); // Last 50

            list.innerHTML = orders.map(o => `
                <div class="order-history-item" style="background:${o.status === 'completed' ? '#e8f5e9' : '#fff3e0'}; padding:10px; border-radius:5px; margin-bottom:5px; border:1px solid #ddd;">
                    <div style="display:flex; justify-content:space-between;">
                        <b>#${o.id} - ${o.date}</b>
                        <span>${o.total} Ø¬</span>
                    </div>
                    <div style="font-size:0.85rem; color:#666; margin-top:5px;">${o.items}</div>
                    <div style="margin-top:5px; display:flex; gap:5px;">
                        <button class="admin-btn" style="width:auto; padding:2px 8px; font-size:0.8rem;" onclick="admPrintReceipt('${o.id}')">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    </div>
                </div>
            `).join('');
        }

        function admPrintReceipt(orderId) {
            const order = database.orders.find(o => o.id == orderId);
            if (!order) return;

            const receipt = document.getElementById('receipt-template');
            document.getElementById('rec-date').innerText = order.date;
            document.getElementById('rec-id').innerText = order.id;

            // Items
            // Assuming items string "falafel (2), hummus (1)" -> parse or save structured
            // For now just show string
            document.getElementById('rec-items').innerHTML = `<div style="border-bottom:1px dashed #000; padding:5px 0;">${order.items.replace(/,/g, '<br>')}</div>`;

            document.getElementById('rec-total').innerText = order.total + " EGP";

            const win = window.open('', '', 'width=300,height=600');
            win.document.write('<html><head><title>Receipt</title><style>body{font-family:monospace; direction:rtl; text-align:center;}</style></head><body>');
            win.document.write(receipt.innerHTML);
            win.document.write('</body></html>');
            win.document.close();
            win.focus();
            win.print();
            win.close();
        }

        // --- Mix Editor ---
        function renderAdmMixEditor() {
            const container = document.getElementById('adm-mix-editor');
            if (!container) return;

            // Find Mix Products
            let mixes = [];
            for (let c in database) {
                if (Array.isArray(database[c])) {
                    database[c].forEach((p, i) => {
                        if (p.isMix) mixes.push({ cat: c, idx: i, ...p });
                    });
                }
            }

            if (mixes.length === 0) {
                container.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª 'Ù…ÙƒØ³' Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
                return;
            }

            container.innerHTML = mixes.map(m => `
                <div style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                    <b>${m.title}</b>
                    <textarea id="mix-content-${m.cat}-${m.idx}" style="width:100%; height:80px; margin-top:5px; border:1px solid #ddd;" placeholder="Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙƒØ³ (ÙƒÙ„ Ø³Ø·Ø± Ù…ÙƒÙˆÙ†)">${(m.contents || []).join('\n')}</textarea>
                    <button class="admin-btn" style="width:auto; margin-top:5px;" onclick="admSaveMixContents('${m.cat}', ${m.idx}, document.getElementById('mix-content-${m.cat}-${m.idx}').value)">Ø­ÙØ¸ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª</button>
                </div>
            `).join('');
        }

        function admSaveMixContents(cat, idx, val) {
            const contents = val ? val.split('\n').filter(x => x.trim()).map(x => x.trim()) : null;
            database[cat][idx].contents = contents;
            saveAdminChanges();
            alert("âœ… ØªÙ… Ø­ÙØ¸ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…ÙƒØ³");
            syncUI();
        }

        function saveAdminChanges() {
            localStorage.setItem('oudelle_custom_database', JSON.stringify(database));
            
            // Real-time sync for all connected clients
            if (isCloudActive && db) {
                db.collection('app').doc('data').set(database).then(() => {
                    console.log("ğŸ”¥ Changes synced to cloud");
                }).catch((error) => {
                    console.error("âŒ Cloud sync error:", error);
                });
            }
        }

        // --- Image Upload Functions ---
        function handleHomeBgUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const dataUrl = e.target.result;
                    // Save to localStorage
                    localStorage.setItem('oudelle_home_bg', dataUrl);
                    // Apply immediately - replace background entirely
                    const sliderBg = document.getElementById('slider-bg');
                    sliderBg.style.background = `url(${dataUrl}) center center / cover no-repeat`;
                    // Show preview
                    document.getElementById('home-bg-preview').innerHTML = 
                        `<img src="${dataUrl}" style="max-width:200px; max-height:150px; border-radius:10px; border:2px solid var(--gold);">
                         <p style="margin-top:5px; color:green;">âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</p>`;
                };
                reader.readAsDataURL(file);
            }
        }

        function handleProductImgUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const dataUrl = e.target.result;
                    // Generate unique filename
                    const fileName = 'product_' + Date.now() + '_' + file.name;
                    // Save to localStorage
                    let uploadedImages = JSON.parse(localStorage.getItem('oudelle_uploaded_images') || '{}');
                    uploadedImages[fileName] = dataUrl;
                    localStorage.setItem('oudelle_uploaded_images', JSON.stringify(uploadedImages));
                    // Auto-fill the image input
                    document.getElementById('adm-img').value = fileName;
                    alert('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ' + fileName);
                };
                reader.readAsDataURL(file);
            }
        }

        // Load saved home background on page load
        window.addEventListener('load', function() {
            const savedBg = localStorage.getItem('oudelle_home_bg');
            if (savedBg) {
                const sliderBg = document.getElementById('slider-bg');
                sliderBg.style.background = `url(${savedBg}) center center / cover no-repeat`;
            }
        });
        
        // Sync images from database to localStorage on load
        function syncImagesFromDatabase() {
            if (database.gallery && database.gallery.length > 0) {
                localStorage.setItem('oudelle_gallery_images', JSON.stringify(database.gallery));
                console.log('ğŸ–¼ï¸ Gallery images synced to localStorage');
            }
        }
        
        // Call sync on load
        syncImagesFromDatabase();
    </script>
    <div class="admin-trigger" onclick="openAdmin()" style="position: fixed; bottom: 20px; left: 20px; background: var(--gold); color: white; padding: 10px 15px; border-radius: 50px; cursor: pointer; font-size: 20px; z-index: 9999; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">âš™ï¸</div>
    <div style="position: fixed; top: 10px; right: 10px; z-index: 9999;">
        <button onclick="openAdmin()" style="background: linear-gradient(135deg, var(--primary), var(--gold)); color: white; border: none; padding: 8px 16px; border-radius: 25px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
            ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </button>
    </div>
    <!-- Thermal Receipt Template (Hidden) -->
    <div id="thermal-receipt">
        <center>
            <h2 style="margin:5px 0;">oudÃ©lle</h2>
            <p style="margin:2px 0;">Ø£ÙˆØ¯ÙŠÙ„ - Naga Hammadi</p>
            <p id="receipt-date"></p>
            <hr>
            <h3 id="receipt-num"></h3>
            <hr>
        </center>
        <div id="receipt-items"></div>
        <hr>
        <div style="display:flex; justify-content:space-between; font-weight:bold;">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span id="receipt-total"></span>
        </div>
        <p id="receipt-client" style="font-size:0.9rem; margin-top:10px;"></p>
        <center>
            <hr>
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…! â¤ï¸</p>
        </center>
    </div>

    <!-- Initialization -->
    <script>
        // Ensure products display on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                console.log('ğŸš€ Initializing app...');
                ensureDefaults();
                renderCategories();
                render(currentCat);
                renderBestSellers();
                renderGallery();
                syncUI();
                console.log('âœ… App initialized!');
            }, 200);
        });
    </script>

</body>

</html>